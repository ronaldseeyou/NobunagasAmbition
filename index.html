<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8"/>
<title>ä¿¡é•·ä¹‹é‡æœ› æˆ°ç¸¾ç¶²</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --acc:#94a3b8;--acc2:#64748b;--win:#4ade80;--lose:#f87171;--gold:#fbbf24;
  --card:rgba(15,20,35,0.9);--bdr:rgba(148,163,184,0.1);
  --bg:radial-gradient(circle at top,#0d1117,#020408);
  --text:#e2e8f0;--sub:#64748b;--dim:#1e293b;
}
body{font-family:system-ui,-apple-system,sans-serif;background:var(--bg);min-height:100vh;color:var(--text);overflow-x:hidden}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes rateShake{0%,100%{transform:scale(1.06) translateX(0)}33%{transform:scale(1.06) translateX(-2px)}66%{transform:scale(1.06) translateX(2px)}}
.fade-up{animation:fadeUp .35s ease both}

/* HEADER */
#header{position:sticky;top:0;z-index:50;background:rgba(2,4,8,0.97);backdrop-filter:blur(18px);border-bottom:1px solid var(--bdr);box-shadow:0 2px 20px rgba(0,0,0,.8)}
#header-inner{max-width:900px;margin:0 auto;padding:12px 16px 0}
.brand-row{display:flex;align-items:center;gap:12px;margin-bottom:10px}
#castle-icon{width:44px;height:44px;flex-shrink:0;border-radius:10px;overflow:hidden;border:1.5px solid rgba(148,163,184,.25);box-shadow:0 0 16px rgba(148,163,184,.08)}
#castle-icon img{width:100%;height:100%;object-fit:cover}
.brand-title{font-size:18px;font-weight:800;color:#e2e8f0;letter-spacing:1px;line-height:1.2}
.brand-sub{font-size:10px;color:#475569;letter-spacing:.8px;margin-top:2px}
#live-badge{padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;flex-shrink:0}
.tabs{display:flex;overflow-x:auto;scrollbar-width:none}
.tabs::-webkit-scrollbar{display:none}
.tab-btn{padding:8px 18px;background:transparent;color:#64748b;border:none;border-bottom:2px solid transparent;cursor:pointer;font-size:13px;font-weight:600;font-family:inherit;transition:all .2s;white-space:nowrap}
.tab-btn.active{color:#e2e8f0;border-bottom-color:#94a3b8}
.tab-btn:hover:not(.active){color:#94a3b8}

/* LAYOUT */
#app{max-width:900px;margin:0 auto;padding:16px 14px 60px}
.tab-pane{display:none}.tab-pane.active{display:block}
.sec-bar{display:flex;align-items:center;gap:10px;margin:20px 0 12px;padding-left:12px;position:relative}
.sec-bar::before{content:'';position:absolute;left:0;top:10%;bottom:10%;width:3px;background:var(--sub);border-radius:2px}
.sec-bar span{font-size:15px;font-weight:700;color:#cbd5e1;letter-spacing:.3px}
.card{background:var(--card);backdrop-filter:blur(14px);border:1px solid var(--bdr);border-radius:13px;padding:16px 18px;margin-bottom:18px}

/* VS BAR */
.vs-wrap{position:relative;transition:transform .05s ease}
.vs-track{
  position:relative;height:100px;border-radius:10px;overflow:hidden;cursor:pointer;
  border:1px solid rgba(212,175,55,.3);
  box-shadow:inset 0 1px 0 rgba(255,255,255,.04),0 4px 20px rgba(0,0,0,.5);
  background:repeating-linear-gradient(0deg,transparent,transparent 3px,rgba(255,255,255,.008) 3px,rgba(255,255,255,.008) 4px),#0d0e11;
}
.vs-left{position:absolute;top:0;left:0;bottom:0;background:linear-gradient(90deg,#3d0000,#7a0000 50%,#c0392b 85%,#e74c3c);transition:width .9s cubic-bezier(.4,0,.2,1)}
.vs-right{position:absolute;top:0;right:0;bottom:0;background:linear-gradient(270deg,#00103d,#002580 50%,#1a5fa0 85%,#2980b9);transition:width .9s cubic-bezier(.4,0,.2,1)}
.vs-left::after,.vs-right::after{content:'';position:absolute;inset:0;background:repeating-linear-gradient(45deg,transparent,transparent 5px,rgba(255,255,255,.02) 5px,rgba(255,255,255,.02) 6px)}
.vs-gold-line{position:absolute;bottom:0;left:0;width:100%;height:3px;background:linear-gradient(90deg,transparent,#d4af37,transparent);opacity:.5;z-index:2;pointer-events:none}
.vs-pc,.vs-lc{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}
.vs-pc{z-index:5}.vs-lc{z-index:15}
.vs-info{position:absolute;inset:0;z-index:20;display:flex;justify-content:space-between;align-items:center;padding:0 24px;pointer-events:none}
.vs-side{display:flex;flex-direction:column;gap:2px}
.vs-side.right{align-items:flex-end}
.vs-cname{font-size:11px;font-weight:800;letter-spacing:2px;color:rgba(255,255,255,.45);text-transform:uppercase}
.vs-pct{font-size:38px;font-weight:900;color:#d4af37;text-shadow:2px 2px 8px rgba(0,0,0,.8),0 0 18px rgba(212,175,55,.25);line-height:1;font-style:italic}
.vs-side.hovered .vs-pct{animation:rateShake .3s ease infinite}
.vs-sub-line{margin-top:8px;text-align:center;font-size:10px;color:rgba(255,255,255,.25);letter-spacing:.5px}

/* PLAYER TABLE */
.ptable-wrap{background:var(--card);border:1px solid var(--bdr);border-radius:13px;backdrop-filter:blur(14px);overflow:hidden;margin-bottom:8px}
.prow-wrap{border-bottom:1px solid rgba(148,163,184,.04);cursor:pointer;transition:background .15s;border-left:4px solid transparent;display:grid;grid-template-columns:24px 1fr 90px 36px 68px;gap:6px;align-items:center;padding:11px 12px}
.prow-wrap:hover{background:rgba(148,163,184,.03)}
.prow-wrap.open{background:rgba(148,163,184,.04);border-left-color:#475569}
.prow-wrap.last-win{border-left-color:rgba(74,222,128,.4)}
.prow-wrap.last-lose{border-left-color:rgba(248,113,113,.3)}
.hero-expand-row{overflow:hidden;border-bottom:1px solid rgba(148,163,184,.03)}

/* BADGES */
.badge{font-size:10px;padding:2px 6px;border-radius:5px;font-weight:700;display:inline-block;white-space:nowrap}
.badge-win{background:rgba(74,222,128,.07);color:#4ade80;border:1px solid rgba(74,222,128,.18)}
.badge-lose{background:rgba(248,113,113,.07);color:#f87171;border:1px solid rgba(248,113,113,.18)}
.badge-blue{background:rgba(148,163,184,.07);color:#94a3b8;border:1px solid rgba(148,163,184,.18)}
.badge-teal{background:rgba(45,212,191,.07);color:#2dd4bf;border:1px solid rgba(45,212,191,.18)}
.rate-num{font-size:17px;font-weight:800;line-height:1}
.hrow{display:grid;grid-template-columns:1fr auto 50px;gap:8px;align-items:center;padding:6px 10px;border-radius:6px;transition:background .12s;margin-bottom:2px}
.hrow:hover{background:rgba(255,255,255,.03)}

/* TEAM CARDS */
.team-card{background:var(--card);border:1px solid var(--bdr);border-radius:11px;padding:12px 14px;display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:7px;transition:background .15s}
.team-card:hover{background:rgba(20,28,50,.97)}
.tag{font-size:11px;font-weight:700;padding:2px 8px;background:rgba(148,163,184,.05);border:1px solid rgba(148,163,184,.1);border-radius:20px;color:#94a3b8}
.hero-chip{font-size:10px;padding:1px 5px;border-radius:5px;font-weight:600}
.hero-chip-0{background:rgba(251,191,36,.06);border:1px solid rgba(251,191,36,.15);color:#fbbf24}
.hero-chip-1{background:rgba(148,163,184,.05);border:1px solid rgba(148,163,184,.1);color:#475569}
.hero-chip-2{background:rgba(148,163,184,.03);border:1px solid rgba(148,163,184,.07);color:#334155}

/* TIMELINE */
.timeline-wrap{position:relative;padding-left:26px}
.timeline-line{position:absolute;left:8px;top:8px;bottom:0;width:2px;background:linear-gradient(to bottom,rgba(148,163,184,.25),rgba(148,163,184,.02))}
.tl-date-node{position:relative;margin-bottom:18px}
.tl-dot{position:absolute;left:-21px;top:3px;width:11px;height:11px;border-radius:50%;background:#475569;border:2px solid #020408;z-index:1}
.tl-dot.new{background:#4ade80;box-shadow:0 0 12px rgba(74,222,128,.45)}
.tl-date-label{display:flex;align-items:center;gap:8px;margin-bottom:7px;flex-wrap:wrap;cursor:pointer;user-select:none}
.tl-date-text{font-size:14px;font-weight:800;color:var(--text)}
.new-badge{background:rgba(74,222,128,.1);color:#4ade80;border:1px solid rgba(74,222,128,.25);font-size:10px;font-weight:700;padding:1px 6px;border-radius:7px}
.tl-date-meta{display:flex;gap:8px;font-size:11px;align-items:center;flex-wrap:wrap}
.tl-toggle{font-size:12px;color:var(--dim);margin-left:auto}
.tl-matches{overflow:hidden;transition:max-height .3s ease}
.match-compact{background:rgba(5,8,15,.8);border:1px solid var(--bdr);border-radius:9px;margin-bottom:7px;overflow:hidden}
.match-compact-head{display:flex;align-items:center;justify-content:space-between;padding:6px 12px;border-bottom:1px solid rgba(148,163,184,.04);background:rgba(2,4,8,.6)}
.match-teams{display:grid;grid-template-columns:1fr 1fr}
.match-team-col{padding:9px 12px}
.match-team-col:first-child{border-right:1px solid rgba(148,163,184,.04)}
.match-team-name{font-size:12px;font-weight:800;margin-bottom:5px}
.match-player-line{display:flex;justify-content:space-between;padding:3px 0;font-size:12px}

/* TOOLS */
.pick-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(84px,1fr));gap:8px;margin-bottom:18px}
.pick-item{padding:9px 6px;text-align:center;cursor:pointer;border-radius:8px;background:rgba(5,8,15,.8);border:1px solid rgba(148,163,184,.08);color:#94a3b8;font-weight:600;font-size:13px;transition:all .15s}
.pick-item.sel{background:rgba(148,163,184,.08);border-color:#64748b;color:#cbd5e1}
.rand-btn{padding:11px 40px;border-radius:8px;border:none;font-family:inherit;font-size:14px;font-weight:700;cursor:pointer;transition:all .2s}
.rand-btn.on{background:linear-gradient(135deg,#334155,#64748b);color:var(--text);box-shadow:0 4px 16px rgba(100,116,139,.2)}
.rand-btn.on:hover{background:linear-gradient(135deg,#475569,#94a3b8)}
.rand-btn.off{background:rgba(10,14,25,.6);color:#1e293b;cursor:not-allowed}
.team-result-card{background:var(--card);border:1px solid var(--bdr);border-radius:14px;padding:18px 20px}
.team-result-teams{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.result-team{padding:12px 14px;border-radius:9px;background:rgba(5,8,15,.8)}
.export-btn{padding:8px 22px;border-radius:7px;border:1px solid rgba(148,163,184,.15);background:rgba(5,8,15,.8);color:#64748b;font-size:12px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .2s;display:inline-flex;align-items:center;gap:6px}
.export-btn:hover{background:rgba(148,163,184,.08);color:#94a3b8}

.row{display:flex;align-items:center}.row-sb{display:flex;align-items:center;justify-content:space-between}
.row-wrap{display:flex;align-items:center;flex-wrap:wrap}.col{display:flex;flex-direction:column}
.fw7{font-weight:700}.fw8{font-weight:800}.fw6{font-weight:600}
.green{color:#4ade80}.red{color:#f87171}.muted{color:#475569}.dim2{color:#64748b}
.fs9{font-size:9px}.fs10{font-size:10px}.fs11{font-size:11px}.fs12{font-size:12px}
.fs13{font-size:13px}.fs14{font-size:14px}.fs15{font-size:15px}.fs16{font-size:16px}
.ta-c{text-align:center}.ta-r{text-align:right}
footer{text-align:center;padding-top:36px;color:#0c1118;font-size:10px;letter-spacing:2px}

@media(max-width:520px){
  .vs-pct{font-size:26px!important}
  .vs-track{height:82px}
  .match-teams,.team-result-teams{grid-template-columns:1fr}
  .match-team-col:first-child{border-right:none;border-bottom:1px solid rgba(148,163,184,.04)}
  .tab-btn{padding:7px 12px;font-size:12px}
  .prow-wrap{grid-template-columns:24px 1fr 80px 60px!important}
  .prow-wrap>div:nth-child(4){display:none}
}
</style>
</head>
<body>

<div id="header">
  <div id="header-inner">
    <div class="brand-row">
      <div id="castle-icon">
        <img src="https://raw.githubusercontent.com/ronaldseeyou/NobunagasAmbition/main/images/p4JFAns.jpg" alt="icon" onerror="this.style.display='none'"/>
      </div>
      <div>
        <div class="brand-title">ä¿¡é•·ä¹‹é‡æœ› æˆ°ç¸¾ç¶²</div>
        <div class="brand-sub">NOBUNAGA'S AMBITION</div>
      </div>
      <div style="margin-left:auto">
        <div id="live-badge" style="background:rgba(100,116,139,.1);border:1px solid rgba(100,116,139,.3);color:#475569">â³ SYNC</div>
      </div>
    </div>
    <div class="tabs">
      <button class="tab-btn active" onclick="setTab('players')">ğŸ‘¥ ç©å®¶</button>
      <button class="tab-btn" onclick="setTab('matches')">ğŸ“… æ¯æ—¥å°æˆ°</button>
      <button class="tab-btn" onclick="setTab('tools')">ğŸ› ï¸ å·¥å…·</button>
    </div>
  </div>
</div>

<div id="app">
  <div id="pane-players" class="tab-pane active">
    <div class="sec-bar" style="margin-top:10px"><span>âš”ï¸ è¼‰å…¥ä¸­...</span></div>
    <div class="card" style="height:120px;background:rgba(15,20,35,.5)"></div>
  </div>
  <div id="pane-matches" class="tab-pane"></div>
  <div id="pane-tools" class="tab-pane"></div>
</div>

<script>
/* ================================================================
   âš¡ VS BAR ENGINE v3
   ä¿®æ”¹å‹ç‡: vsBarInit(odaPct) â€” é›»æ“Šç·š+Barå¯¬åº¦å…¨éƒ¨è‡ªå‹•åŒæ­¥
================================================================ */
let _vsOda=50,_vsAF=null,_vsLC=null,_vsPC=null;
let _vsW=0,_vsH=0,_vsDPR=1,_vsHov=null;
let _vsShT=0,_vsSX=0,_vsSY=0,_vsFT=0,_vsLB=0,_vsPts=[];

function vsBarInit(pct){
  _vsOda=Math.max(5,Math.min(95,pct));
  const tr=document.getElementById('vs-track');
  const lc=document.getElementById('vs-lc');
  const pc=document.getElementById('vs-pc');
  if(!tr||!lc||!pc)return;
  if(_vsAF){cancelAnimationFrame(_vsAF);_vsAF=null;}
  _vsPts=[];
  _vsDPR=window.devicePixelRatio||1;
  _vsW=tr.offsetWidth;_vsH=tr.offsetHeight;
  [lc,pc].forEach(c=>{
    c.width=_vsW*_vsDPR;c.height=_vsH*_vsDPR;
    c.style.width=_vsW+'px';c.style.height=_vsH+'px';
  });
  _vsLC=lc.getContext('2d');_vsLC.scale(_vsDPR,_vsDPR);
  _vsPC=pc.getContext('2d');_vsPC.scale(_vsDPR,_vsDPR);
  const lb=document.getElementById('vs-lb'),rb=document.getElementById('vs-rb');
  if(lb)lb.style.width=_vsOda+'%';
  if(rb)rb.style.width=(100-_vsOda)+'%';
  const rl=document.getElementById('vs-rl'),rr=document.getElementById('vs-rr');
  if(rl)rl.textContent=_vsOda+'%';
  if(rr)rr.textContent=(100-_vsOda)+'%';
  tr.onmousemove=e=>{
    const r=tr.getBoundingClientRect();
    const side=(e.clientX-r.left)<(_vsOda/100*_vsW)?'left':'right';
    if(side!==_vsHov){
      _vsHov=side;
      document.getElementById('vs-fl')?.classList.toggle('hovered',side==='left');
      document.getElementById('vs-fr')?.classList.toggle('hovered',side==='right');
    }
  };
  tr.onmouseleave=()=>{
    _vsHov=null;
    ['vs-fl','vs-fr'].forEach(id=>document.getElementById(id)?.classList.remove('hovered'));
  };
  clearTimeout(window._vsRT);
  window.addEventListener('resize',()=>{clearTimeout(window._vsRT);window._vsRT=setTimeout(()=>vsBarInit(_vsOda),220);},{once:true});
  _vsAF=requestAnimationFrame(_vsLoop);
}

function _vsGenBolt(cx,str){
  const pts=[{x:cx,y:0}];let y=0;
  const jit=13*str;
  while(y<_vsH){
    y+=3+Math.random()*7;
    pts.push({x:cx+(Math.random()-.5)*jit*2,y:Math.min(y,_vsH)});
  }
  return pts;
}

function _vsDrawBolt(pts,alpha,gc,lw){
  if(pts.length<2)return;
  const c=_vsLC;
  [3,2,1].forEach(p=>{
    c.save();c.beginPath();c.moveTo(pts[0].x,pts[0].y);
    pts.slice(1).forEach(pt=>c.lineTo(pt.x,pt.y));
    c.strokeStyle=gc;c.globalAlpha=alpha*.1*p;
    c.lineWidth=lw*p*3.5;c.shadowBlur=18*p;c.shadowColor=gc;
    c.lineCap=c.lineJoin='round';c.stroke();c.restore();
  });
  c.save();c.beginPath();c.moveTo(pts[0].x,pts[0].y);
  pts.slice(1).forEach(pt=>c.lineTo(pt.x,pt.y));
  c.strokeStyle=`rgba(255,255,255,${alpha})`;c.globalAlpha=alpha;
  c.lineWidth=lw;c.shadowBlur=6;c.shadowColor='#fff';
  c.lineCap=c.lineJoin='round';c.stroke();c.restore();
}

function _vsSpawn(cx){
  const n=_vsHov?5:2;
  for(let i=0;i<n;i++){
    if(_vsPts.length>=80)break;
    _vsPts.push({
      x:cx+(Math.random()-.5)*18,y:Math.random()*_vsH,
      sz:Math.random()*2+.5,vx:(Math.random()-.5)*2.5,
      vy:-(Math.random()*2.5+1),op:.9+Math.random()*.1,
      h:Math.random()<.5?'w':Math.random()<.5?'b':'o'
    });
  }
}

function _vsDrawParts(){
  const c=_vsPC;c.clearRect(0,0,_vsW,_vsH);
  for(let i=_vsPts.length-1;i>=0;i--){
    const p=_vsPts[i];
    p.x+=p.vx;p.y+=p.vy;p.op-=.018;p.vy*=.98;
    if(p.op<=0||p.y<-5){_vsPts.splice(i,1);continue;}
    const col=p.h==='w'?`rgba(255,255,255,${p.op})`:
               p.h==='b'?`rgba(100,160,255,${p.op})`:`rgba(255,130,40,${p.op})`;
    c.save();c.fillStyle=col;c.shadowBlur=5;c.shadowColor=col;
    c.beginPath();c.arc(p.x,p.y,p.sz,0,Math.PI*2);c.fill();c.restore();
  }
}

function _vsLoop(ts){
  _vsLC.clearRect(0,0,_vsW,_vsH);
  const cx=(_vsOda/100)*_vsW;
  let str=_vsHov?1.9:1.0;
  if(ts-_vsLB>2200+Math.random()*600&&Math.random()<.03){
    _vsLB=ts;_vsFT=8;_vsShT=10;
    _vsSX=(Math.random()-.5)*10*str;_vsSY=(Math.random()-.5)*4*str;
  }
  if(_vsFT>0){_vsFT--;str*=2.0;}
  const n=_vsHov?5:2+Math.floor(Math.random()*2);
  for(let i=0;i<n;i++){
    const jit=(Math.random()-.5)*6,al=.4+Math.random()*.6;
    const gc=['#6688ff','#aa66ff','#88ccff','#ffffff'][Math.floor(Math.random()*4)];
    _vsDrawBolt(_vsGenBolt(cx+jit,str),al,gc,1+Math.random());
  }
  // åˆ†å‰é–ƒé›» (æ¯3å¹€)
  if(Math.floor(ts/16)%3===0){
    const bx=cx+(Math.random()-.5)*8,by=_vsH*(.15+Math.random()*.6);
    const bp=[{x:bx,y:by}];let bby=by;
    while(bby<by+_vsH*.3){bby+=3+Math.random()*6;bp.push({x:bx+(Math.random()-.5)*22,y:bby});}
    _vsDrawBolt(bp,.15+Math.random()*.2,'#aabbff',.5);
  }
  if(_vsFT>5){
    _vsLC.save();
    _vsLC.fillStyle=`rgba(255,255,255,${(_vsFT-5)/4*.22})`;
    _vsLC.fillRect(0,0,_vsW,_vsH);_vsLC.restore();
  }
  _vsSpawn(cx);_vsDrawParts();
  const wrap=document.getElementById('vs-wrap');
  if(wrap){
    if(_vsShT>0){_vsShT--;const d=_vsShT/10;wrap.style.transform=`translate(${_vsSX*d}px,${_vsSY*d}px)`;}
    else wrap.style.transform='none';
  }
  _vsAF=requestAnimationFrame(_vsLoop);
}

/* ================================================================
   DATA ENGINE
================================================================ */
const SHEET_ID='1dTL4GswalL2faUeKUfe0NhNuj39RmodSa7zBNjVTM-U';
const CSV_URL=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=Sheet1`;

const dateNum=d=>{const m=d.match(/(\d+)æœˆ(\d+)æ—¥/);return m?+m[1]*100+ +m[2]:0;};
const matchNum=s=>{const m=s.match(/ç¬¬(\d+)å ´/);return m?+m[1]:0;};
const rateCol=r=>r>=60?'#4ade80':r>=40?'#fbbf24':'#f87171';

function parseCSV(text){
  const lines=text.trim().split('\n');let hi=0;
  for(let i=0;i<Math.min(lines.length,10);i++){
    if(lines[i].includes('ç©å®¶')||lines[i].toLowerCase().includes('player')){hi=i;break;}
  }
  return lines.slice(hi+1).map(line=>{
    const cols=[];let cur='',inQ=false;
    for(const ch of line){
      if(ch==='"')inQ=!inQ;
      else if(ch===','&&!inQ){cols.push(cur.trim());cur='';}
      else cur+=ch;
    }
    cols.push(cur.trim());
    const c=cols.map(x=>x.replace(/"/g,'').trim());
    const[date,match,betStr,wl,sideRaw,player,hero]=c;
    if(!date||!wl||!player)return null;
    const side=sideRaw==='ç¹”ç”°è»'||sideRaw.toLowerCase()==='oda'?'oda':'united';
    return{date,match,bet:parseInt(betStr)||0,wl:wl.toUpperCase(),side,player,hero:hero||''};
  }).filter(Boolean);
}

function buildMatches(rows){
  const map={};
  rows.forEach(r=>{
    const key=`${r.date}_${r.match}`;
    if(!map[key])map[key]={date:r.date,match:r.match,bet:r.bet,oda:[],united:[],winner:null};
    (r.side==='oda'?map[key].oda:map[key].united).push({player:r.player,hero:r.hero});
    if(r.wl==='W')map[key].winner=r.side;
  });
  return Object.values(map).sort((a,b)=>{
    const dd=dateNum(b.date)-dateNum(a.date);
    return dd!==0?dd:matchNum(a.match)-matchNum(b.match);
  });
}

function buildPlayerStats(matches){
  const pd={};
  const ensure=n=>{if(!pd[n])pd[n]={name:n,wins:0,losses:0,money:0,history:[],heroes:{}};};
  matches.forEach(m=>{
    const oc=m.oda.length,uc=m.united.length,bet=m.bet;
    let odD=0,unD=0;
    if(m.winner==='oda'){odD=oc>0?(uc*bet/oc):0;unD=-bet;}
    else{unD=uc>0?(oc*bet/uc):0;odD=-bet;}
    const proc=(list,isWin,delta)=>{
      list.forEach(p=>{
        ensure(p.player);const d=pd[p.player];
        isWin?d.wins++:d.losses++;d.money+=delta;
        d.history.push({won:isWin,dn:dateNum(m.date),mn:matchNum(m.match),hero:p.hero});
        if(!d.heroes[p.hero])d.heroes[p.hero]={wins:0,losses:0};
        isWin?d.heroes[p.hero].wins++:d.heroes[p.hero].losses++;
      });
    };
    proc(m.oda,m.winner==='oda',odD);
    proc(m.united,m.winner==='united',unD);
  });
  return Object.values(pd).map(p=>{
    p.history.sort((a,b)=>a.dn!==b.dn?a.dn-b.dn:a.mn-b.mn);
    const total=p.wins+p.losses,rate=total?Math.round(p.wins/total*100):0;
    const heroStats=Object.entries(p.heroes)
      .map(([name,{wins,losses}])=>({name,wins,losses,total:wins+losses}))
      .sort((a,b)=>b.total-a.total||b.wins-a.wins);
    const spark=p.history.slice(-5).map(h=>h.won?1:0);
    while(spark.length<5)spark.unshift(null);
    const lastWon=p.history.length?p.history[p.history.length-1].won:false;
    let streak=0;
    for(let i=p.history.length-1;i>=0;i--){if(p.history[i].won===lastWon)streak++;else break;}
    return{...p,total,rate,heroStats,spark,streak,streakWin:lastWon};
  });
}

function buildTeamStats(matches){
  const tm={};
  matches.forEach(m=>{
    [['oda',m.oda],['united',m.united]].forEach(([side,pls])=>{
      const won=m.winner===side;
      const key=[...pls].map(p=>p.player).sort().join('Â·');
      if(!tm[key])tm[key]={key,members:[...pls].map(p=>p.player).sort(),wins:0,losses:0,heroes:{}};
      won?tm[key].wins++:tm[key].losses++;
      pls.forEach(p=>{tm[key].heroes[p.hero]=(tm[key].heroes[p.hero]||0)+1;});
    });
  });
  return Object.values(tm).map(t=>{
    const total=t.wins+t.losses,rate=total?Math.round(t.wins/total*100):0;
    const topHeroes=Object.entries(t.heroes).sort((a,b)=>b[1]-a[1]).slice(0,3).map(([h])=>h);
    return{...t,total,rate,topHeroes};
  }).filter(t=>t.total>=2).sort((a,b)=>b.rate-a.rate||b.total-a.total);
}

function calcBestTeammate(playerName,matches){
  const pw={},pt={};
  matches.forEach(m=>{
    [['oda',m.oda],['united',m.united]].forEach(([side,pls])=>{
      const won=m.winner===side,names=pls.map(p=>p.player);
      if(!names.includes(playerName))return;
      names.forEach(n=>{if(n===playerName)return;pt[n]=(pt[n]||0)+1;if(won)pw[n]=(pw[n]||0)+1;});
    });
  });
  let best=null,bestR=-1;
  Object.keys(pt).forEach(n=>{if(pt[n]<2)return;const r=(pw[n]||0)/pt[n];if(r>bestR){bestR=r;best=n;}});
  return best&&bestR>=0.6?best:null;
}

function sparklineHTML(spark){
  const r=5,w=68,sp=(w-r*2*spark.length)/(spark.length-1);
  return`<svg width="${w}" height="${r*2}" style="overflow:visible;display:block">${spark.map((v,i)=>`<circle cx="${r+(r*2+sp)*i+r}" cy="${r}" r="${v===null?2:r}" fill="${v===null?'rgba(255,255,255,.07)':v?'#4ade80':'#f87171'}"/>`).join('')}</svg>`;
}

function computeBadges(players,matches){
  const maxPool=Math.max(...players.map(p=>p.heroStats.length));
  const btMap={};players.forEach(p=>{btMap[p.name]=calcBestTeammate(p.name,matches);});
  const btCount={};Object.values(btMap).forEach(n=>{if(n)btCount[n]=(btCount[n]||0)+1;});
  const topBT=Object.entries(btCount).sort((a,b)=>b[1]-a[1])[0]?.[0]||null;
  return players.map(p=>{
    const badges=[];
    if(p.streakWin&&p.streak>=3)badges.push({cls:'badge-win',txt:`ğŸ”¥${p.streak}é€£å‹`});
    if(!p.streakWin&&p.streak>=3)badges.push({cls:'badge-lose',txt:`â„ï¸${p.streak}é€£æ•—`});
    if(p.heroStats.length===maxPool&&maxPool>3)badges.push({cls:'badge-blue',txt:'ğŸ¯è‹±é›„ç‹'});
    if(p.name===topBT)badges.push({cls:'badge-teal',txt:'ğŸ¤æœ€ä½³éšŠå“¡'});
    return{...p,badges};
  });
}

let openedPlayer=null,hSort='count';
let allPlayers=[],allMatches=[],allTeams=[],allPNames=[];

function renderPlayers(){
  if(!allPlayers.length){
    document.getElementById('pane-players').innerHTML=`<div style="text-align:center;padding:60px 20px;color:#475569"><div style="font-size:36px;margin-bottom:14px;opacity:.4">ğŸ“Š</div><div style="font-size:14px;font-weight:600;margin-bottom:6px">æš«ç„¡ç©å®¶æ•¸æ“š</div></div>`;
    return;
  }
  const withBadges=computeBadges(allPlayers,allMatches);
  const sorted=[...withBadges].sort((a,b)=>b.rate-a.rate||b.total-a.total);
  const odaW=allMatches.filter(m=>m.winner==='oda').length;
  const totM=allMatches.length;
  const odaPct=totM?Math.round(odaW/totM*100):50,uniPct=100-odaPct;

  let html=`
  <div class="sec-bar"><span>âš”ï¸ é™£ç‡Ÿå‹ç‡</span></div>
  <div class="card fade-up">
    <div class="vs-wrap" id="vs-wrap">
      <div class="vs-track" id="vs-track">
        <div class="vs-left"  id="vs-lb" style="width:0"></div>
        <div class="vs-right" id="vs-rb" style="width:0"></div>
        <canvas class="vs-pc" id="vs-pc"></canvas>
        <canvas class="vs-lc" id="vs-lc"></canvas>
        <div class="vs-info">
          <div class="vs-side left" id="vs-fl">
            <span class="vs-cname">ç¹”ç”°è»</span>
            <span class="vs-pct" id="vs-rl">${odaPct}%</span>
          </div>
          <div class="vs-side right" id="vs-fr">
            <span class="vs-cname">è¯åˆè»</span>
            <span class="vs-pct" id="vs-rr">${uniPct}%</span>
          </div>
        </div>
        <div class="vs-gold-line"></div>
      </div>
      <div class="vs-sub-line">å…± ${totM} å ´ &nbsp;Â·&nbsp; ç¹”ç”°è» ${odaW}W &nbsp;Â·&nbsp; è¯åˆè» ${totM-odaW}W</div>
    </div>
  </div>
  <div class="sec-bar"><span>ğŸ† ç©å®¶ç¸½è¦½</span></div>
  <div class="ptable-wrap fade-up">`;

  sorted.forEach((p,i)=>{
    const col=rateCol(p.rate);
    const rankIcon=i===0?'ğŸ¥‡':i===1?'ğŸ¥ˆ':i===2?'ğŸ¥‰':i+1;
    const rankCol=i===0?'#fbbf24':i===1?'#94a3b8':i===2?'#78350f':'#334155';
    const isOpen=openedPlayer===p.name;
    const moneyRaw=Math.round(p.money*10)/10;
    const moneyStr=`${moneyRaw>=0?'+':''}$${moneyRaw}`;
    const moneyColor=moneyRaw>=0?'#4ade80':'#f87171';
    const rowCls=p.streakWin?'last-win':'last-lose';
    const badgeHTML=p.badges.map(b=>`<span class="badge ${b.cls}">${b.txt}</span>`).join('');

    html+=`<div>
      <div class="prow-wrap ${rowCls}${isOpen?' open':''}" onclick="togglePlayer('${p.name}')">
        <div class="fs14 fw7 ta-c" style="font-size:${i<3?15:12}px;color:${rankCol}">${rankIcon}</div>
        <div>
          <div class="row-wrap" style="line-height:1.3">
            <span class="fs14 fw7" style="color:#e2e8f0">${p.name}</span>
            <span style="margin-left:5px">${badgeHTML}</span>
          </div>
          <div class="row fs12" style="gap:5px;align-items:baseline;margin-top:3px">
            <span class="fw7 green">${p.wins}W</span>
            <span class="muted">/</span>
            <span class="fw7 red">${p.losses}L</span>
            <span class="muted fs11">${p.total}å ´</span>
          </div>
        </div>
        <div class="col ta-c" style="gap:4px">
          <div class="rate-num" style="color:${col}">${p.rate}%</div>
          ${sparklineHTML(p.spark)}
        </div>
        <div class="ta-c">
          <div class="fs16 fw8" style="color:#64748b">${p.heroStats.length}</div>
        </div>
        <div class="ta-r">
          <div class="fs14 fw7" style="color:${moneyColor}">${moneyStr}</div>
        </div>
      </div>
      <div class="hero-expand-row" id="expand-${p.name}" style="max-height:${isOpen?'2000px':'0'};transition:max-height .3s ease">
        ${isOpen?heroExpandHTML(p):''}
      </div>
    </div>`;
  });

  html+=`</div>
  <div style="text-align:center;font-size:10px;color:#0f172a;margin-bottom:22px">â†‘ é»æ“Šè¡Œå±•é–‹è‹±é›„æ± è©³æƒ… â†‘</div>
  <div class="sec-bar"><span>ğŸ¤ çµ„éšŠå‹ç‡</span></div>`;

  allTeams.forEach((t,ti)=>{
    const heroChips=t.topHeroes.map((h,idx)=>`<span class="hero-chip hero-chip-${idx}">${['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'][idx]} ${h}</span>`).join('');
    html+=`<div class="team-card fade-up" style="animation-delay:${ti*.04}s">
      <div style="flex-shrink:0;min-width:46px;text-align:center">
        <div class="fs16 fw8" style="font-size:20px;color:${rateCol(t.rate)}">${t.rate}%</div>
      </div>
      <div style="flex:1;min-width:120px">
        <div class="row-wrap" style="gap:4px;margin-bottom:6px">${t.members.map(m=>`<span class="tag">${m}</span>`).join('')}</div>
        <div class="row-wrap" style="gap:4px">
          <span class="fs9 muted" style="margin-right:2px">é»˜å¥‘è‹±é›„</span>${heroChips}
        </div>
      </div>
      <div style="text-align:right;flex-shrink:0;min-width:52px">
        <div class="row" style="align-items:baseline;justify-content:flex-end;gap:2px">
          <span class="fw7 green fs15">${t.wins}</span><span class="muted fs10">W</span>
          <span style="color:#0d1117;margin:0 1px">Â·</span>
          <span class="red fw6 fs15">${t.losses}</span><span class="muted fs10">L</span>
        </div>
        <div class="fs10 dim2" style="margin-top:1px">${t.total} å ´</div>
      </div>
    </div>`;
  });

  document.getElementById('pane-players').innerHTML=html;
  setTimeout(()=>{
    const p2=totM?Math.round(odaW/totM*100):50;
    vsBarInit(p2);
  },120);
}

function heroExpandHTML(p){
  const s=[...p.heroStats].sort((a,b)=>{
    if(hSort==='rate'){const ra=a.total?a.wins/a.total:0,rb=b.total?b.wins/b.total:0;return rb-ra||b.total-a.total;}
    return b.total-a.total;
  });
  const sortBtns=['count','rate'].map(k=>`<button onclick="setHSort('${k}',event)" style="padding:2px 8px;background:${hSort===k?'#475569':'rgba(5,8,15,.8)'};color:${hSort===k?'#f1f5f9':'#334155'};border:1px solid ${hSort===k?'#64748b':'rgba(148,163,184,.08)'};border-radius:4px;cursor:pointer;font-size:10px;font-weight:700;font-family:inherit">${k==='count'?'æ¬¡æ•¸':'å‹ç‡'}</button>`).join('');
  return`<div style="padding:10px 14px 12px">
    <div class="row-sb" style="margin-bottom:8px;flex-wrap:wrap;gap:5px">
      <span class="fs10 muted" style="text-transform:uppercase;letter-spacing:.8px;font-weight:700">è‹±é›„æ±  (${p.heroStats.length})</span>
      <div style="display:flex;gap:3px">${sortBtns}</div>
    </div>
    <div style="display:flex;flex-direction:column;gap:3px">
      ${s.map(h=>{const hr=h.total?Math.round(h.wins/h.total*100):0;return`
        <div class="hrow">
          <span class="fs12 fw6" style="color:#cbd5e1">${h.name}</span>
          <span class="fs10 muted">${h.total}å ´ Â· ${h.wins}W${h.losses?` / ${h.losses}L`:''}</span>
          <span class="fs13 fw7 ta-r" style="color:${rateCol(hr)}">${hr}%</span>
        </div>`}).join('')}
    </div>
  </div>`;
}

const openDates=new Set();
function renderMatches(){
  const dg={};
  allMatches.forEach(m=>(dg[m.date]=dg[m.date]||[]).push(m));
  Object.values(dg).forEach(ms=>ms.sort((a,b)=>matchNum(a.match)-matchNum(b.match)));
  const entries=Object.entries(dg).sort(([a],[b])=>dateNum(b)-dateNum(a));
  const newestDate=entries[0]?.[0];
  if(openDates.size===0&&newestDate)openDates.add(newestDate);
  if(!entries.length){
    document.getElementById('pane-matches').innerHTML=`<div style="text-align:center;padding:60px 20px;color:#475569"><div style="font-size:36px;margin-bottom:14px;opacity:.4">ğŸ“…</div><div>æš«ç„¡å°æˆ°è¨˜éŒ„</div></div>`;
    return;
  }
  let html=`<div class="sec-bar"><span>ğŸ“… å°æˆ°æ­·å²</span></div><div class="timeline-wrap"><div class="timeline-line"></div>`;
  entries.forEach(([date,ms],di)=>{
    const dOdaW=ms.filter(m=>m.winner==='oda').length;
    const isNewest=date===newestDate,isOpen=openDates.has(date);
    const matchesHTML=ms.map(m=>`<div class="match-compact">
      <div class="match-compact-head">
        <span style="font-size:12px;font-weight:700;color:#94a3b8">${m.match}</span>
        <span style="font-size:11px;font-weight:700;color:#fbbf24">$${m.bet}</span>
      </div>
      <div class="match-teams">
        ${[{team:m.oda,side:'oda',label:'ç¹”ç”°è»'},{team:m.united,side:'united',label:'è¯åˆè»'}].map(({team,side,label})=>{
          const won=m.winner===side,nc=won?'#4ade80':'#f87171';
          return`<div class="match-team-col">
            <div class="match-team-name" style="color:${nc}">${label}<span style="font-size:10px;padding:1px 5px;border-radius:4px;margin-left:4px;background:${won?'rgba(74,222,128,.07)':'rgba(248,113,113,.07)'};color:${nc}">${won?'å‹':'æ•—'}</span></div>
            ${team.map(pl=>`<div class="match-player-line"><span style="color:${won?'#e2e8f0':'#64748b'};font-weight:600">${pl.player}</span><span style="color:${won?'#64748b':'#334155'}">${pl.hero}</span></div>`).join('')}
          </div>`;
        }).join('')}
      </div>
    </div>`).join('');
    html+=`<div class="tl-date-node fade-up" style="animation-delay:${di*.05}s">
      <div class="tl-dot${isNewest?' new':''}"></div>
      <div class="tl-date-label" onclick="toggleDate('${date}')">
        <span class="tl-date-text">${date}</span>${isNewest?'<span class="new-badge">NEW</span>':''}
        <div class="tl-date-meta">
          <span style="color:#475569">${ms.length}å ´</span>
          ${isNewest?`<span style="font-weight:700;color:#fbbf24">$${ms[0]?.bet}/å ´</span>`:''}
          <span style="font-weight:600;color:#4ade80">ç¹”ç”°${dOdaW}W</span>
          <span style="font-weight:600;color:#f87171">è¯åˆ${ms.length-dOdaW}W</span>
        </div>
        <span class="tl-toggle">${isOpen?'â–²':'â–¼'}</span>
      </div>
      <div class="tl-matches" style="max-height:${isOpen?'2000px':'0'}">${isOpen?matchesHTML:''}</div>
    </div>`;
  });
  html+=`</div>`;
  document.getElementById('pane-matches').innerHTML=html;
}
function toggleDate(date){openDates.has(date)?openDates.delete(date):openDates.add(date);renderMatches();}

let pickedSet=new Set(),teamRes=null;
async function exportTeamImage(){
  const el=document.getElementById('export-target');if(!el)return;
  const btn=document.querySelector('.export-btn');
  if(btn){btn.textContent='â³ ç”Ÿæˆä¸­...';btn.disabled=true;}
  try{
    const canvas=await html2canvas(el,{backgroundColor:'#0d1117',scale:2,useCORS:true,logging:false});
    canvas.toBlob(async blob=>{
      const file=new File([blob],'ä¿¡é•·åˆ†éšŠçµæœ.png',{type:'image/png'});
      if(navigator.share&&navigator.canShare&&navigator.canShare({files:[file]})){
        try{await navigator.share({files:[file],title:'ä¿¡é•·ä¹‹é‡æœ› åˆ†éšŠçµæœ',text:'ä»Šæ—¥åˆ†éšŠå‡ºçˆ âš”ï¸'});}
        catch(e){if(e.name!=='AbortError')fallbackDownload(blob);}
      }else{fallbackDownload(blob);}
      if(btn){btn.textContent='ğŸ“¸ åˆ†äº«åœ–ç‰‡';btn.disabled=false;}
    },'image/png');
  }catch(e){if(btn){btn.textContent='ğŸ“¸ åˆ†äº«åœ–ç‰‡';btn.disabled=false;}alert('æˆªåœ–å¤±æ•—ï¼Œè«‹é‡è©¦');}
}
function fallbackDownload(blob){
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='ä¿¡é•·åˆ†éšŠçµæœ.png';a.click();
  setTimeout(()=>URL.revokeObjectURL(a.href),5000);
}

function renderTools(){
  const canRand=pickedSet.size>=6&&pickedSet.size<=7;
  const pickItems=allPNames.map(n=>`<div class="pick-item${pickedSet.has(n)?' sel':''}" onclick="togglePick('${n}')">${pickedSet.has(n)?'âœ“ ':''}${n}</div>`).join('');
  const pRateMap={},pStatsMap={};
  allPlayers.forEach(p=>{pRateMap[p.name]=p.rate;pStatsMap[p.name]={wins:p.wins,total:p.total};});
  let teamHTML='';
  if(teamRes){
    teamHTML=`<div id="export-target" class="team-result-card fade-up" style="margin-top:18px">
      <div style="font-size:17px;font-weight:700;text-align:center;color:#e2e8f0;margin-bottom:14px">âš”ï¸ åˆ†éšŠçµæœ</div>
      <div class="team-result-teams">
        ${[{team:teamRes.oda,label:'ğŸ”´ ç¹”ç”°è»',col:'#ef4444'},{team:teamRes.united,label:'ğŸ”µ è¯åˆè»',col:'#3b82f6'}].map(({team,label,col})=>{
          const tW=team.reduce((s,n)=>s+(pStatsMap[n]?.wins||0),0);
          const tG=team.reduce((s,n)=>s+(pStatsMap[n]?.total||0),0);
          const avgRate=tG?Math.round(tW/tG*100):0;
          return`<div class="result-team" style="border-top:2px solid ${col}">
            <div class="row-sb" style="margin-bottom:9px">
              <span style="font-size:12px;font-weight:800;color:${col}">${label}</span>
              <span style="font-size:11px;font-weight:700;color:${rateCol(avgRate)}">éšŠå‡ ${avgRate}%</span>
            </div>
            ${team.map((n,i)=>`<div class="row-sb" style="padding:6px 0;border-bottom:${i<team.length-1?'1px solid rgba(255,255,255,.04)':'none'}">
              <span style="font-size:14px;font-weight:600;color:#e2e8f0">${n}</span>
              <span style="font-size:12px;font-weight:700;color:${rateCol(pRateMap[n]||0)}">${pRateMap[n]||0}%</span>
            </div>`).join('')}
          </div>`;
        }).join('')}
      </div>
    </div>
    <div class="row" style="justify-content:center;gap:10px;margin-top:12px">
      <button onclick="doRandom()" style="padding:7px 22px;border-radius:7px;border:1px solid rgba(148,163,184,.1);background:rgba(5,8,15,.8);color:#475569;font-size:12px;font-weight:600;cursor:pointer;font-family:inherit">ğŸ² é‡æ–°åˆ†éšŠ</button>
      <button onclick="exportTeamImage()" class="export-btn">ğŸ“¸ åˆ†äº«åœ–ç‰‡</button>
    </div>`;
  }
  document.getElementById('pane-tools').innerHTML=`
    <div class="sec-bar"><span>ğŸ² éš¨æ©Ÿåˆ†éšŠå·¥å…·</span></div>
    <div class="card">
      <div class="row" style="gap:8px;margin-bottom:12px">
        <span style="font-size:14px;font-weight:600;color:#cbd5e1">é¸æ“‡ 6 æˆ– 7 ä½ç©å®¶</span>
        <span style="font-size:12px;color:${canRand?'#4ade80':'#475569'}">å·²é¸ ${pickedSet.size} äºº${canRand?' âœ“':''}</span>
      </div>
      <div class="pick-grid">${pickItems}</div>
      <div class="ta-c"><button onclick="doRandom()" class="rand-btn ${canRand?'on':'off'}">ğŸ² éš¨æ©Ÿåˆ†éšŠ</button></div>
    </div>${teamHTML}`;
}

function setTab(id){
  document.querySelectorAll('.tab-btn').forEach((b,i)=>b.classList.toggle('active',['players','matches','tools'][i]===id));
  document.querySelectorAll('.tab-pane').forEach(p=>p.classList.remove('active'));
  document.getElementById(`pane-${id}`).classList.add('active');
}
function togglePlayer(name){
  openedPlayer=openedPlayer===name?null:name;
  renderPlayers();
}
function setHSort(k,e){
  e&&e.stopPropagation();hSort=k;
  if(openedPlayer){
    const el=document.getElementById(`expand-${openedPlayer}`);
    const p=allPlayers.find(x=>x.name===openedPlayer);
    if(el&&p)el.innerHTML=heroExpandHTML(p);
  }
}
function togglePick(n){pickedSet.has(n)?pickedSet.delete(n):pickedSet.add(n);renderTools();}
function doRandom(){
  if(pickedSet.size<6||pickedSet.size>7)return alert('è«‹é¸æ“‡ 6 æˆ– 7 ä½ç©å®¶ï¼');
  const sel=[...pickedSet];
  for(let i=sel.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[sel[i],sel[j]]=[sel[j],sel[i]];}
  const h=Math.ceil(sel.length/2);teamRes={oda:sel.slice(0,h),united:sel.slice(h)};renderTools();
}

(async function init(){
  const badge=document.getElementById('live-badge');
  try{
    const ctrl=new AbortController();setTimeout(()=>ctrl.abort(),9000);
    const res=await fetch(CSV_URL,{signal:ctrl.signal});
    if(!res.ok)throw new Error();
    const text=await res.text();const rows=parseCSV(text);
    if(rows.length<2)throw new Error();
    allMatches=buildMatches(rows);
    allPlayers=buildPlayerStats(allMatches);
    allTeams=buildTeamStats(allMatches);
    allPNames=[...new Set(rows.map(r=>r.player))];
    badge.style.cssText='padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;background:rgba(74,222,128,.08);border:1px solid rgba(74,222,128,.25);color:#4ade80';
    badge.textContent='â— LIVE';
  }catch(e){
    badge.style.cssText='padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;background:rgba(248,113,113,.08);border:1px solid rgba(248,113,113,.25);color:#f87171';
    badge.textContent='âš  ç„¡æ•¸æ“š';
    document.getElementById('pane-players').innerHTML=`<div style="text-align:center;padding:60px 20px;color:#334155"><div style="font-size:32px;margin-bottom:12px">ğŸ“­</div><div style="font-size:15px;font-weight:600;margin-bottom:6px;color:#475569">æœªèƒ½è¼‰å…¥æ•¸æ“š</div></div>`;
  }
  renderPlayers();renderMatches();renderTools();
})();
</script>

<footer>âœ¦ ä¿¡é•·ä¹‹é‡æœ› æˆ°ç¸¾ç¶² Â· æ•¸æ“šç”± Google Sheets é©…å‹• âœ¦</footer>
</body>
</html>
