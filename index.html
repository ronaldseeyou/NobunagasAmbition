<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8" />
  <title>ä¿¡é•·ä¹‹é‡æœ› æˆ°ç¸¾çµ±è¨ˆ v12.2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    :root {
      --bg: #020617; --card: #111827; --header-bg: #030712;
      --border: #1f2937; --accent: #38bdf8; --text: #e5e7eb;
      --muted: #9ca3af; 
      --win: linear-gradient(135deg, #22c55e 0%, #4ade80 100%); /* Green Gradient */
      --lose: linear-gradient(135deg, #dc2626 0%, #ef4444 100%); /* Red Gradient */
      --money: #fbbf24; 
      --oda-default: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
      --united-default: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: radial-gradient(circle at top, #0b1120 0, #020617 50%, #000 100%);
      color: var(--text); min-height: 100vh; padding-bottom: 80px;
    }
    
    /* Header - Expanded */
    header { position: sticky; top: 0; z-index: 10; padding: 20px 16px; border-bottom: 1px solid var(--border); background: rgba(3,7,18,0.95); backdrop-filter: blur(10px); }
    .header-content { display: flex; align-items: center; gap: 16px; }
    .header-icon { width: 80px; height: 80px; border-radius: 12px; object-fit: cover; border: 3px solid var(--accent); box-shadow: 0 4px 12px rgba(56, 189, 248, 0.3); }
    .header-text { flex: 1; display: flex; flex-direction: column; justify-content: center; }
    h1 { font-size: 24px; font-weight: 800; color: var(--accent); margin-bottom: 6px; letter-spacing: 0.5px; line-height: 1.2; }
    h2 { font-size: 14px; color: var(--muted); font-weight: 500; line-height: 1.4; }

    .container { max-width: 900px; margin: 0 auto; padding: 16px; }
    
    /* State Messages */
    #loading-state, #error-state { text-align: center; padding: 40px; font-size: 16px; display: none; }
    #loading-state { color: var(--accent); }
    #error-state { color: #ef4444; }

    .tabs { display: flex; gap: 8px; margin: 16px 0; border-bottom: 2px solid var(--border); overflow-x: auto; }
    .tab { padding: 12px 20px; background: transparent; color: var(--muted); border: none; cursor: pointer; font-size: 15px; font-weight: 500; border-bottom: 2px solid transparent; transition: all 0.2s; white-space: nowrap; }
    .tab:hover { color: var(--text); }
    .tab.active { color: var(--accent); border-bottom-color: var(--accent); }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    .section-title { margin: 24px 0 12px; font-size: 16px; font-weight: 600; color: #fff; display: flex; align-items: center; gap: 8px; }
    
    /* Stats Bars - Dynamic Colors */
    .faction-stats { background: var(--card); border-radius: 12px; border: 1px solid var(--border); padding: 20px; margin-bottom: 24px; }
    .faction-header { font-size: 14px; color: var(--muted); margin-bottom: 12px; text-align: center; }
    .faction-bar-container { display: flex; height: 50px; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.3); background: #1f2937; }
    .faction-bar { display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 16px; transition: all 0.5s ease; position: relative; min-width: 10%; }
    .faction-bar span { z-index: 1; text-shadow: 0 2px 4px rgba(0,0,0,0.5); white-space: nowrap; padding: 0 8px; }
    
    /* Table */
    .table-card { background: var(--card); border-radius: 12px; border: 1px solid var(--border); overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; font-size: 13px; text-align: left; }
    th { background: #1f2937; color: var(--muted); font-weight: 500; padding: 10px 14px; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; }
    td { padding: 12px 14px; border-bottom: 1px solid var(--border); }
    tr:last-child td { border-bottom: none; }
    tr:hover { background: rgba(56, 189, 248, 0.05); }
    .player-name { font-weight: 600; color: #fff; display: block; }
    .win-rate { font-weight: 700; }
    .win-rate.high { color: #4ade80; }
    .win-rate.mid { color: #fbbf24; }
    .win-rate.low { color: #f87171; }
    .money { font-family: monospace; font-weight: 600; }
    .money.plus { color: #4ade80; }
    .money.minus { color: #f87171; }
    
    /* Hero Stats */
    .hero-stats-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; }
    .hero-stats-card { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 16px; }
    .hero-stats-header { font-size: 15px; font-weight: 600; color: #fff; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid var(--border); }
    .hero-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; font-size: 13px; }
    .hero-item:not(:last-child) { border-bottom: 1px solid #1e293b; }
    .hero-name { color: var(--text); font-weight: 500; }
    .hero-stats { color: var(--muted); font-size: 12px; }
    .hero-rate { margin-left: 12px; font-weight: 600; }
    .hero-rate.high { color: #4ade80; }
    .hero-rate.mid { color: #fbbf24; }
    .hero-rate.low { color: #f87171; }
    
    /* Matches List */
    .date-group { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 16px; margin-bottom: 20px; }
    .date-header { font-size: 18px; font-weight: 700; color: var(--accent); margin-bottom: 16px; padding-bottom: 10px; border-bottom: 2px solid var(--border); }
    .match-card { background: #0f172a; border: 1px solid #1e293b; border-radius: 10px; margin-bottom: 12px; padding: 14px; }
    .match-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; font-size: 13px; padding-bottom: 8px; border-bottom: 1px solid #1e293b; }
    .match-number { color: var(--muted); font-weight: 600; }
    .match-bet { color: var(--money); font-weight: 600; }
    .match-teams { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .team { padding: 10px; border-radius: 8px; }
    .team.oda { border: 1px solid rgba(239, 68, 68, 0.3); }
    .team.united { border: 1px solid rgba(59, 130, 246, 0.3); }
    .team.oda.winner, .team.united.winner { background: rgba(74, 222, 128, 0.15); border-color: rgba(74, 222, 128, 0.4); }
    .team.oda.loser, .team.united.loser { background: rgba(248, 113, 113, 0.15); border-color: rgba(248, 113, 113, 0.4); }
    .team-header { font-size: 13px; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; display: flex; align-items: center; gap: 6px; }
    .team.oda .team-header { color: #ef4444; }
    .team.united .team-header { color: #3b82f6; }
    .team.winner .team-header::before { content: "âœ…"; }
    .team.loser .team-header::before { content: "âŒ"; opacity: 0.5; }
    .match-player { font-size: 13px; margin-bottom: 6px; line-height: 1.5; padding: 4px 0; }
    .match-player strong { color: var(--text); font-weight: 600; }
    .match-player span { opacity: 0.7; font-size: 12px; margin-left: 6px; }
    
    /* Tools Tab */
    .tools-card { background: var(--card); border-radius: 12px; border: 1px solid var(--border); padding: 24px; margin-bottom: 20px; }
    .tools-title { font-size: 18px; font-weight: 600; color: #fff; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 2px solid var(--border); }
    .player-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 12px; margin-bottom: 20px; }
    .player-checkbox { display: flex; align-items: center; gap: 8px; padding: 10px 14px; background: #0f172a; border: 2px solid var(--border); border-radius: 8px; cursor: pointer; transition: all 0.2s; }
    .player-checkbox:hover { border-color: var(--accent); }
    .player-checkbox.selected { border-color: var(--accent); background: rgba(56, 189, 248, 0.1); }
    .player-checkbox input[type="checkbox"] { cursor: pointer; }
    .player-checkbox label { cursor: pointer; font-size: 14px; font-weight: 500; }
    .btn { padding: 12px 24px; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px; }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
    .btn:active { transform: translateY(0); }
    .btn-primary { background: linear-gradient(135deg, var(--accent) 0%, #0ea5e9 100%); color: #fff; }
    .btn-secondary { background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%); color: #fff; }
    #team-result-container { margin-top: 24px; display: none; }
    .team-display { background: var(--card); border-radius: 12px; border: 1px solid var(--border); padding: 24px; margin-bottom: 20px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3); }
    .team-display-header { text-align: center; font-size: 20px; font-weight: 700; color: var(--accent); margin-bottom: 8px; }
    .team-display-date { text-align: center; font-size: 13px; color: var(--muted); margin-bottom: 20px; }
    .teams-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .team-box { padding: 20px; border-radius: 10px; }
    .team-box.oda { background: rgba(239, 68, 68, 0.1); border: 2px solid #ef4444; }
    .team-box.united { background: rgba(59, 130, 246, 0.1); border: 2px solid #3b82f6; }
    .team-box-title { font-size: 18px; font-weight: 700; text-align: center; margin-bottom: 16px; text-transform: uppercase; letter-spacing: 1px; }
    .team-box.oda .team-box-title { color: #ef4444; }
    .team-box.united .team-box-title { color: #3b82f6; }
    .team-box-player { padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px; margin-bottom: 8px; text-align: center; font-size: 16px; font-weight: 600; color: #fff; }
    .action-buttons { display: flex; justify-content: center; gap: 12px; margin-top: 20px; }
    footer { text-align: center; font-size: 12px; color: var(--muted); margin-top: 40px; opacity: 0.5; }
    
    @media (max-width: 768px) {
      .header-icon { width: 60px; height: 60px; }
      h1 { font-size: 20px; }
      .teams-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<header>
  <div class="container">
    <div class="header-content">
      <!-- Image expands to 80px, responsive -->
      <img src="images/p4JFAns.jpg" alt="Logo" class="header-icon" onerror="this.style.display='none'">
      <div class="header-text">
        <h1>âš”ï¸ ä¿¡é•·ä¹‹é‡æœ› æˆ°ç¸¾ç¶²</h1>
        <h2>å³æ™‚çµ±è¨ˆ / é™£ç‡Ÿå°æŠ— / è‹±é›„æ•¸æ“š</h2>
      </div>
    </div>
  </div>
</header>

<div class="container">
  <div id="loading-state">â³ æ­£åœ¨å¾ Google Sheets è¼‰å…¥æ•¸æ“š...</div>
  <div id="error-state"></div>

  <div id="main-content" style="display: none;">
    <div class="tabs">
      <button class="tab active" onclick="switchTab('players')">ğŸ‘¥ ç©å®¶</button>
      <button class="tab" onclick="switchTab('matches')">ğŸ“… æ¯æ—¥å°æˆ°</button>
      <button class="tab" onclick="switchTab('tools')">ğŸ› ï¸ å·¥å…·</button>
    </div>

    <!-- Players Tab -->
    <div id="players-tab" class="tab-content active">
      <div class="section-title">âš”ï¸ é™£ç‡Ÿå‹ç‡</div>
      <div class="faction-stats">
        <div class="faction-header">ç¸½å…± <span id="total-matches">0</span> å ´å°æˆ°</div>
        <div class="faction-bar-container">
          <!-- Dynamic colors will be applied here by JS -->
          <div class="faction-bar" id="oda-bar"><span id="oda-text">ç¹”ç”°è» 0%</span></div>
          <div class="faction-bar" id="united-bar"><span id="united-text">è¯åˆè» 0%</span></div>
        </div>
      </div>
      <div class="section-title">ğŸ† ç©å®¶ç¸½è¦½</div>
      <div class="table-card">
        <table>
          <thead>
            <tr>
              <th>ç©å®¶</th><th>å ´æ•¸ (W/L)</th><th>å‹ç‡</th><th>è‹±é›„æ± </th><th>ç¸½é‡‘é¡</th>
            </tr>
          </thead>
          <tbody id="player-overview-body"></tbody>
        </table>
      </div>
      <div class="section-title">ğŸ¯ ç©å®¶è‹±é›„å‹ç‡</div>
      <div class="hero-stats-grid" id="hero-stats-container"></div>
    </div>

    <!-- Matches Tab -->
    <div id="matches-tab" class="tab-content">
      <div class="section-title">ğŸ“… å°æˆ°æ­·å²</div>
      <div id="matches-list"></div>
    </div>

    <!-- Tools Tab -->
    <div id="tools-tab" class="tab-content">
      <div class="section-title">ğŸ² éš¨æ©Ÿåˆ†éšŠå·¥å…·</div>
      <div class="tools-card">
        <div class="tools-title">åƒåŠ ç©å®¶ (è«‹é¸æ“‡ 6 ä½)</div>
        <div class="player-grid" id="player-selection"></div>
        <div style="text-align: center;">
          <button class="btn btn-primary" onclick="randomTeams()">ğŸ² éš¨æ©Ÿåˆ†éšŠ</button>
        </div>
      </div>
      <div id="team-result-container">
        <div class="team-display" id="capture-area"></div>
        <div class="action-buttons">
          <button class="btn btn-primary" onclick="randomTeams()">ğŸ² é‡æ–°åˆ†éšŠ</button>
          <button class="btn btn-secondary" onclick="captureImage()">ğŸ“¸ å„²å­˜åœ–ç‰‡åˆ†äº«</button>
        </div>
      </div>
    </div>

    <footer>Last Updated: <span id="last-update"></span></footer>
  </div>
</div>

<script>
  // CONFIG
  const SHEET_ID = '1dTL4GswalL2faUeKUfe0NhNuj39RmodSa7zBNjVTM-U';
  const SHEET_NAME = 'Sheet1';
  const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${SHEET_NAME}`;

  let matches = [];
  let allPlayers = new Set();

  async function loadData() {
    const loadingEl = document.getElementById('loading-state');
    const mainEl = document.getElementById('main-content');
    const errorEl = document.getElementById('error-state');

    loadingEl.style.display = 'block';

    try {
      const response = await fetch(CSV_URL);
      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
      const csvText = await response.text();
      
      matches = parseCSV(csvText);
      
      if (matches.length === 0) {
        throw new Error('æˆåŠŸè®€å–æª”æ¡ˆï¼Œä½†æ‰¾ä¸åˆ°ä»»ä½•å°æˆ°æ•¸æ“šã€‚è«‹æª¢æŸ¥ Google Sheet æ¬„ä½åç¨±ã€‚');
      }

      loadingEl.style.display = 'none';
      mainEl.style.display = 'block';
      renderSite();
      initPlayerSelection();
    } catch (error) {
      console.error(error);
      loadingEl.style.display = 'none';
      errorEl.style.display = 'block';
      errorEl.innerHTML = `âŒ è¼‰å…¥å¤±æ•—: ${error.message}<br><br>è«‹ç¢ºèª Google Sheet å·²è¨­ç‚ºã€ŒçŸ¥é“é€£çµçš„äººå‡å¯æª¢è¦–ã€ï¼Œä¸”ç¬¬ä¸€è¡ŒåŒ…å«æ­£ç¢ºæ¨™é¡Œ (Date, Winner, Side, Player...)`;
    }
  }

  function parseCSV(csvText) {
    const rows = [];
    let currentRow = [];
    let currentCell = '';
    let insideQuote = false;
    
    for (let i = 0; i < csvText.length; i++) {
      const char = csvText[i];
      const nextChar = csvText[i+1];
      
      if (char === '"') {
        if (insideQuote && nextChar === '"') {
          currentCell += '"'; 
          i++;
        } else {
          insideQuote = !insideQuote;
        }
      } else if (char === ',' && !insideQuote) {
        currentRow.push(currentCell.trim());
        currentCell = '';
      } else if ((char === '\r' || char === '\n') && !insideQuote) {
        if (char === '\r' && nextChar === '\n') i++;
        if (currentCell || currentRow.length > 0) currentRow.push(currentCell.trim());
        if (currentRow.length > 0) rows.push(currentRow);
        currentRow = [];
        currentCell = '';
      } else {
        currentCell += char;
      }
    }
    if (currentCell || currentRow.length > 0) {
      currentRow.push(currentCell.trim());
      rows.push(currentRow);
    }

    if (rows.length < 2) return [];

    const header = rows[0].map(h => h.toLowerCase());
    const getIdx = (keywords) => header.findIndex(h => keywords.some(k => h.includes(k)));

    const idxDate = getIdx(['date', 'æ—¥æœŸ']);
    const idxMatch = getIdx(['match', 'å ´æ¬¡']);
    const idxBet = getIdx(['bet', 'è³­æ³¨']);
    const idxWinner = getIdx(['winner', 'è´å®¶']);
    const idxSide = getIdx(['side', 'é™£ç‡Ÿ']);
    const idxPlayer = getIdx(['player', 'ç©å®¶']);
    const idxHero = getIdx(['hero', 'è‹±é›„']);

    if (idxDate === -1 || idxWinner === -1 || idxPlayer === -1) {
      throw new Error(`æ‰¾ä¸åˆ°é—œéµæ¬„ä½ã€‚è«‹ç¢ºä¿ç¬¬ä¸€è¡ŒåŒ…å«: Date(æ—¥æœŸ), Winner(è´å®¶), Player(ç©å®¶)`);
    }

    const matchesMap = {};
    rows.slice(1).forEach(row => {
      if (row.length < 3) return;

      const date = row[idxDate];
      const matchName = idxMatch > -1 ? row[idxMatch] : '';
      const bet = idxBet > -1 ? (parseInt(row[idxBet]) || 0) : 0;
      const winner = idxWinner > -1 ? row[idxWinner].toLowerCase() : '';
      const side = idxSide > -1 ? row[idxSide].toLowerCase() : '';
      const player = idxPlayer > -1 ? row[idxPlayer] : 'Unknown';
      const hero = idxHero > -1 ? row[idxHero] : '';

      if (!date || !player) return;

      const key = `${date}-${matchName}`;
      if (!matchesMap[key]) {
        matchesMap[key] = {
          date: `${date} ${matchName}`.trim(),
          bet: bet,
          winner: winner.includes('oda') || winner.includes('ç¹”ç”°') ? 'oda' : 'united',
          oda: [],
          united: []
        };
      }

      const isOdaSide = side.includes('oda') || side.includes('ç¹”ç”°');
      if (isOdaSide) {
        matchesMap[key].oda.push({ name: player, hero });
      } else {
        matchesMap[key].united.push({ name: player, hero });
      }
      allPlayers.add(player);
    });

    return Object.values(matchesMap);
  }

  function renderSite() {
    const stats = {};
    const heroStats = {};
    let odaWins = 0, unitedWins = 0;

    matches.forEach(m => {
      if (m.winner === 'oda') odaWins++; else unitedWins++;
      m.oda.forEach(p => updateStats(p, 'oda', m.winner, m.bet));
      m.united.forEach(p => updateStats(p, 'united', m.winner, m.bet));
    });

    function updateStats(p, side, winner, bet) {
      if (!stats[p.name]) stats[p.name] = { wins: 0, losses: 0, money: 0, heroes: [] };
      const won = side === winner;
      if (won) {
        stats[p.name].wins++;
        stats[p.name].money += bet;
      } else {
        stats[p.name].losses++;
        stats[p.name].money -= bet;
      }
      stats[p.name].heroes.push(p.hero);

      if (!heroStats[p.name]) heroStats[p.name] = {};
      if (!heroStats[p.name][p.hero]) heroStats[p.name][p.hero] = { wins: 0, losses: 0 };
      if (won) heroStats[p.name][p.hero].wins++;
      else heroStats[p.name][p.hero].losses++;
    }

    // Stats Bar Logic
    const total = matches.length;
    const odaPct = total ? Math.round((odaWins/total)*100) : 0;
    const unitedPct = total ? Math.round((unitedWins/total)*100) : 0;
    
    document.getElementById('total-matches').innerText = total;
    
    const odaBar = document.getElementById('oda-bar');
    const unitedBar = document.getElementById('united-bar');
    
    odaBar.style.width = `${odaPct}%`;
    unitedBar.style.width = `${unitedPct}%`;
    document.getElementById('oda-text').innerText = `ç¹”ç”°è» ${odaPct}%`;
    document.getElementById('united-text').innerText = `è¯åˆè» ${unitedPct}%`;

    // Dynamic Coloring based on Win Rate Comparison
    if (odaPct > unitedPct) {
      odaBar.style.background = 'var(--win)';
      unitedBar.style.background = 'var(--lose)';
    } else if (unitedPct > odaPct) {
      odaBar.style.background = 'var(--lose)';
      unitedBar.style.background = 'var(--win)';
    } else {
      odaBar.style.background = 'var(--oda-default)';
      unitedBar.style.background = 'var(--united-default)';
    }

    // Player Table
    const sortedPlayers = Object.keys(stats).map(name => {
      const s = stats[name];
      const t = s.wins + s.losses;
      return { name, ...s, total: t, rate: t ? Math.round((s.wins/t)*100) : 0, heroPool: new Set(s.heroes).size };
    }).sort((a,b) => b.rate - a.rate || b.money - a.money);

    document.getElementById('player-overview-body').innerHTML = sortedPlayers.map(p => `
      <tr>
        <td><span class="player-name">${p.name}</span></td>
        <td>${p.total} <span style="opacity:0.5;font-size:11px">(${p.wins}W/${p.losses}L)</span></td>
        <td class="win-rate ${p.rate>=60?'high':p.rate>=40?'mid':'low'}">${p.rate}%</td>
        <td>${p.heroPool}</td>
        <td class="money ${p.money>=0?'plus':'minus'}">${p.money>=0?'+':''}$${p.money}</td>
      </tr>
    `).join('');

    // Hero Stats
    document.getElementById('hero-stats-container').innerHTML = sortedPlayers.map(p => {
      const heroes = heroStats[p.name] || {};
      const list = Object.entries(heroes).map(([h, s]) => {
        const t = s.wins + s.losses;
        return { name: h, ...s, total: t, rate: t ? Math.round((s.wins/t)*100) : 0 };
      }).sort((a,b) => b.total - a.total || b.rate - a.rate);

      return `
        <div class="hero-stats-card">
          <div class="hero-stats-header">${p.name}</div>
          ${list.map(h => `
            <div class="hero-item">
              <span class="hero-name">${h.name}</span>
              <div>
                <span class="hero-stats">${h.total}æ¬¡ (${h.wins}-${h.losses})</span>
                <span class="hero-rate ${h.rate>=60?'high':h.rate>=40?'mid':'low'}">${h.rate}%</span>
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }).join('');

    // Matches List
    const matchesByDate = {};
    matches.forEach(m => {
      const date = m.date.split(' ')[0];
      if (!matchesByDate[date]) matchesByDate[date] = [];
      matchesByDate[date].push(m);
    });

    document.getElementById('matches-list').innerHTML = Object.entries(matchesByDate).map(([date, ms]) => `
      <div class="date-group"><div class="date-header">${date}</div>
        ${ms.map(m => {
          const mNum = m.date.split(' ')[1] || '';
          const odaCls = m.winner==='oda'?'winner':'loser';
          const uniCls = m.winner==='united'?'winner':'loser';
          const pList = (list) => list.map(p=>`<div class="match-player"><strong>${p.name}</strong><span>${p.hero}</span></div>`).join('');
          return `
            <div class="match-card">
              <div class="match-header"><span class="match-number">${mNum}</span><span class="match-bet">è³­æ³¨ $${m.bet}</span></div>
              <div class="match-teams">
                <div class="team oda ${odaCls}"><div class="team-header">ç¹”ç”°è»</div>${pList(m.oda)}</div>
                <div class="team united ${uniCls}"><div class="team-header">è¯åˆè»</div>${pList(m.united)}</div>
              </div>
            </div>
          `;
        }).join('')}
      </div>
    `).join('');
    
    document.getElementById('last-update').innerText = new Date().toLocaleString('zh-HK');
  }

  // UI Functions
  function switchTab(id) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    const idx = id==='players'?0:id==='matches'?1:2;
    document.querySelectorAll('.tab')[idx].classList.add('active');
    document.getElementById(id+'-tab').classList.add('active');
  }

  function initPlayerSelection() {
    const list = Array.from(allPlayers).sort();
    document.getElementById('player-selection').innerHTML = list.map(p => `
      <div class="player-checkbox" onclick="togglePlayer(this)">
        <input type="checkbox" value="${p}"><label>${p}</label>
      </div>
    `).join('');
  }

  function togglePlayer(el) {
    const cb = el.querySelector('input');
    if (event.target !== cb) cb.checked = !cb.checked;
    el.classList.toggle('selected', cb.checked);
  }

  function randomTeams() {
    const sel = Array.from(document.querySelectorAll('#player-selection input:checked')).map(c=>c.value);
    if (sel.length !== 6) return alert('âš ï¸ è«‹é¸æ“‡å‰›å¥½ 6 ä½ç©å®¶ï¼');
    
    // Shuffle
    for (let i = sel.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [sel[i], sel[j]] = [sel[j], sel[i]];
    }
    
    const oda = sel.slice(0,3);
    const uni = sel.slice(3,6);
    const now = new Date();
    
    document.getElementById('team-result-container').style.display = 'block';
    document.getElementById('capture-area').innerHTML = `
      <div class="team-display-header">âš”ï¸ å°æˆ°åˆ†çµ„çµæœ âš”ï¸</div>
      <div class="team-display-date">ğŸ“… ${now.toLocaleDateString()} ${now.toLocaleTimeString('zh-HK',{hour:'2-digit',minute:'2-digit'})}</div>
      <div class="teams-grid">
        <div class="team-box oda"><div class="team-box-title">ğŸ”´ ç¹”ç”°è»</div>${oda.map(p=>`<div class="team-box-player">${p}</div>`).join('')}</div>
        <div class="team-box united"><div class="team-box-title">ğŸ”µ è¯åˆè»</div>${uni.map(p=>`<div class="team-box-player">${p}</div>`).join('')}</div>
      </div>
    `;
    setTimeout(() => document.getElementById('capture-area').scrollIntoView({behavior:'smooth'}), 100);
  }

  function captureImage() {
    const btn = event.target;
    const original = btn.innerText;
    btn.innerText = "â³...";
    btn.disabled = true;
    html2canvas(document.getElementById('capture-area'), {
      backgroundColor: '#111827', scale: 3
    }).then(canvas => {
      const a = document.createElement('a');
      a.download = `ä¿¡é•·åˆ†éšŠ_${Date.now()}.png`;
      a.href = canvas.toDataURL();
      a.click();
      btn.innerText = original;
      btn.disabled = false;
    });
  }

  loadData();
</script>
</body>
</html>
