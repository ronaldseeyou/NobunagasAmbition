<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8"/>
<title>ä¿¡é•·ä¹‹é‡æœ› æˆ°ç¸¾ç¶²</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --acc:#38bdf8;--win:#4ade80;--lose:#f87171;--gold:#fbbf24;--mut:#475569;
  --card:rgba(15,23,42,0.82);--bdr:rgba(148,163,184,0.08);
  --bg:radial-gradient(circle at top,#0c1322,#020617);
}
body{font-family:system-ui,-apple-system,sans-serif;background:var(--bg);min-height:100vh;color:#f1f5f9;overflow-x:hidden}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.fade-up{animation:fadeUp .35s ease both}

#header{position:sticky;top:0;z-index:50;background:rgba(3,7,18,0.97);backdrop-filter:blur(18px);border-bottom:1px solid var(--bdr);box-shadow:0 4px 30px rgba(0,0,0,0.65)}
#header-inner{max-width:900px;margin:0 auto;padding:12px 16px 0}
.brand-row{display:flex;align-items:center;gap:12px;margin-bottom:10px}
#castle-icon{width:46px;height:46px;flex-shrink:0;border-radius:11px;overflow:hidden;border:1.5px solid rgba(56,189,248,0.4);box-shadow:0 0 22px rgba(56,189,248,0.2)}
#castle-icon img{width:100%;height:100%;object-fit:cover}
.brand-title{font-size:19px;font-weight:800;color:var(--acc);letter-spacing:1.1px;text-shadow:0 0 18px rgba(56,189,248,.35);line-height:1.2}
.brand-sub{font-size:11px;color:#1a3355;letter-spacing:.8px;margin-top:2px}
#live-badge{padding:3px 11px;border-radius:20px;font-size:11px;font-weight:700;flex-shrink:0;letter-spacing:.5px}
.tabs{display:flex;overflow-x:auto;scrollbar-width:none}
.tabs::-webkit-scrollbar{display:none}
.tab-btn{padding:8px 20px;background:transparent;color:var(--mut);border:none;border-bottom:2px solid transparent;cursor:pointer;font-size:14px;font-weight:600;font-family:inherit;transition:all .2s;white-space:nowrap}
.tab-btn.active{color:var(--acc);border-bottom-color:var(--acc)}

#app{max-width:900px;margin:0 auto;padding:18px 14px 60px}
.tab-pane{display:none}.tab-pane.active{display:block}
.sec-bar{display:flex;align-items:center;gap:10px;margin:22px 0 12px;padding-left:12px;position:relative}
.sec-bar::before{content:'';position:absolute;left:0;top:10%;bottom:10%;width:3px;background:var(--acc);border-radius:2px;box-shadow:0 0 8px rgba(56,189,248,.45)}
.sec-bar span{font-size:16px;font-weight:700;color:#f1f5f9;letter-spacing:.4px}
.card{background:var(--card);backdrop-filter:blur(14px);border:1px solid var(--bdr);border-radius:14px;padding:16px 20px;margin-bottom:22px}

.fac-nums{display:flex;justify-content:space-between;margin-bottom:12px}
.fac-big{font-size:34px;font-weight:800;line-height:1}
.fac-lbl{font-size:11px;color:var(--mut);margin-top:5px}
.fac-track{height:9px;border-radius:4px;overflow:hidden;background:rgba(0,0,0,.3);display:flex}
.fac-seg{height:100%;transition:width 1.1s ease}

.ptable-wrap{background:var(--card);border:1px solid var(--bdr);border-radius:14px;backdrop-filter:blur(14px);overflow:hidden;margin-bottom:8px}
.ptable-head{padding:9px 14px;background:rgba(8,14,30,.95);border-bottom:1px solid var(--bdr);display:grid;grid-template-columns:26px 1fr 54px 64px 86px 38px 76px;gap:5px;font-size:11px;color:#2a4060;text-transform:uppercase;letter-spacing:.7px;font-weight:700;min-width:520px}
.ptable-head span{text-align:center}.ptable-head span:nth-child(2){text-align:left}
.prow{padding:13px 14px;border-bottom:1px solid rgba(148,163,184,.04);cursor:pointer;display:grid;grid-template-columns:26px 1fr 54px 64px 86px 38px 76px;gap:5px;align-items:center;transition:background .15s;min-width:520px;border-left:3px solid transparent}
.prow:hover{background:rgba(56,189,248,.03)}
.prow.open{background:rgba(56,189,248,.04);border-left-color:var(--acc)}
.badge{font-size:10px;padding:1px 6px;border-radius:8px;font-weight:700;margin-left:4px;display:inline-block}
.badge-win{background:rgba(74,222,128,.09);color:var(--win);border:1px solid rgba(74,222,128,.22)}
.badge-lose{background:rgba(248,113,113,.09);color:var(--lose);border:1px solid rgba(248,113,113,.22)}
.badge-gold{background:rgba(251,191,36,.09);color:var(--gold);border:1px solid rgba(251,191,36,.22)}
.badge-grey{background:rgba(100,116,139,.09);color:#94a3b8;border:1px solid rgba(100,116,139,.2)}
.dots{display:flex;gap:3px}
.dot{width:6px;height:6px;border-radius:50%}
.dot-w{background:var(--win);box-shadow:0 0 4px rgba(74,222,128,.65)}
.dot-l{background:rgba(248,113,113,.35)}

.ring-wrap{position:relative;display:inline-flex}
.ring-label{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-weight:800}

.hero-expand{overflow:hidden;background:rgba(5,10,24,.9);border-bottom:1px solid rgba(148,163,184,.04)}
.hrow{display:grid;grid-template-columns:1fr auto 50px;gap:10px;align-items:center;padding:6px 12px;background:rgba(8,14,30,.65);border-radius:6px;border:1px solid rgba(148,163,184,.04);margin-bottom:4px}

.team-card{background:var(--card);border:1px solid var(--bdr);border-radius:12px;padding:14px 16px;backdrop-filter:blur(14px);display:flex;align-items:center;gap:14px;flex-wrap:wrap;margin-bottom:8px}
.tag{font-size:12px;font-weight:700;padding:2px 10px;background:rgba(56,189,248,.06);border:1px solid rgba(56,189,248,.14);border-radius:20px;color:#e2e8f0}
.hero-chip{font-size:10px;padding:1px 7px;border-radius:8px;font-weight:600}
.hero-chip-0{background:rgba(251,191,36,.07);border:1px solid rgba(251,191,36,.2);color:var(--gold)}
.hero-chip-1{background:rgba(15,25,48,.65);border:1px solid var(--bdr);color:#475569}
.hero-chip-2{background:rgba(15,25,48,.65);border:1px solid var(--bdr);color:#2d4a6e}

.date-hdr{display:flex;align-items:center;justify-content:space-between;padding:9px 16px;background:rgba(5,10,24,.94);border-radius:10px;margin-bottom:8px;border:1px solid rgba(56,189,248,.12);flex-wrap:wrap;gap:6px}
.match-card{background:var(--card);border:1px solid var(--bdr);border-radius:12px;overflow:hidden;backdrop-filter:blur(14px);margin-bottom:7px}
.match-meta{display:flex;justify-content:space-between;align-items:center;padding:8px 16px;background:rgba(5,10,24,.82);border-bottom:1px solid var(--bdr)}
.teams-grid{display:grid;grid-template-columns:1fr 1fr}
.team-col{padding:11px 14px}
.team-col-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;padding-bottom:6px;border-bottom:1px solid rgba(148,163,184,.05)}
.p-line{display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-bottom:1px solid rgba(148,163,184,.04)}
.p-line:last-child{border-bottom:none}

.pick-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(88px,1fr));gap:9px;margin-bottom:20px}
.pick-item{padding:10px 6px;text-align:center;cursor:pointer;border-radius:8px;background:rgba(6,12,26,.7);border:1px solid var(--bdr);color:#cbd5e1;font-weight:600;font-size:14px;transition:all .15s}
.pick-item.sel{background:rgba(56,189,248,.12);border-color:var(--acc);color:var(--acc);box-shadow:0 0 14px rgba(56,189,248,.12)}
.rand-btn{padding:12px 44px;border-radius:8px;border:none;font-family:inherit;font-size:15px;font-weight:700;cursor:pointer;transition:all .2s}
.rand-btn.on{background:linear-gradient(135deg,var(--acc),#0ea5e9);color:#000;box-shadow:0 4px 20px rgba(14,165,233,.3)}
.rand-btn.off{background:rgba(15,25,48,.6);color:#2d3748;cursor:not-allowed}
.team-result-card{background:var(--card);backdrop-filter:blur(14px);border:1px solid var(--bdr);border-radius:14px;padding:20px 22px}
.team-result-teams{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.result-team{padding:14px 16px;border-radius:10px;background:rgba(6,12,26,.7)}

footer{text-align:center;padding-top:40px;color:#0c1726;font-size:10px;letter-spacing:2px}
@media(max-width:520px){.teams-grid,.team-result-teams{grid-template-columns:1fr}}
</style>
</head>
<body>

<div id="header">
  <div id="header-inner">
    <div class="brand-row">
      <div id="castle-icon">
        <img src="https://raw.githubusercontent.com/ronaldseeyou/NobunagasAmbition/main/images/p4JFAns.jpg" alt="icon" onerror="this.style.display='none'"/>
      </div>
      <div style="flex:1;min-width:0">
        <div class="brand-title">ä¿¡é•·ä¹‹é‡æœ› æˆ°ç¸¾ç¶²</div>
        <div class="brand-sub">å³æ™‚çµ±è¨ˆ Â· é™£ç‡Ÿå°æŠ— Â· è‹±é›„æ•¸æ“š</div>
      </div>
      <div id="live-badge" style="background:rgba(251,191,36,.11);border:1px solid rgba(251,191,36,.35);color:#fbbf24">â³ SYNC</div>
    </div>
    <div class="tabs">
      <button class="tab-btn active" onclick="setTab('players')">ğŸ‘¥ ç©å®¶</button>
      <button class="tab-btn" onclick="setTab('matches')">ğŸ“… æ¯æ—¥å°æˆ°</button>
      <button class="tab-btn" onclick="setTab('tools')">ğŸ› ï¸ å·¥å…·</button>
    </div>
  </div>
</div>

<div id="app">
  <div id="pane-players" class="tab-pane active"></div>
  <div id="pane-matches" class="tab-pane"></div>
  <div id="pane-tools" class="tab-pane"></div>
</div>

<script>
const SHEET_ID = '1dTL4GswalL2faUeKUfe0NhNuj39RmodSa7zBNjVTM-U';
const CSV_URL  = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=Sheet1`;

const SEED_ROWS=[
  {date:'2æœˆ1æ—¥',match:'ç¬¬1å ´',bet:150,wl:'W',side:'oda',   player:'Water', hero:'å±±ç‹'},
  {date:'2æœˆ1æ—¥',match:'ç¬¬1å ´',bet:150,wl:'W',side:'oda',   player:'æœæ¼”',  hero:'åˆ©å®¶'},
  {date:'2æœˆ1æ—¥',match:'ç¬¬1å ´',bet:150,wl:'W',side:'oda',   player:'Woman', hero:'æ£®ä»”'},
  {date:'2æœˆ1æ—¥',match:'ç¬¬1å ´',bet:150,wl:'W',side:'oda',   player:'ä¿Š',    hero:'ä¿¡é•·'},
  {date:'2æœˆ1æ—¥',match:'ç¬¬1å ´',bet:150,wl:'L',side:'united',player:'å“²',    hero:'è‚¥å·'},
  {date:'2æœˆ1æ—¥',match:'ç¬¬1å ´',bet:150,wl:'L',side:'united',player:'å‚‘',    hero:'æ¾å§¬'},
  {date:'2æœˆ1æ—¥',match:'ç¬¬1å ´',bet:150,wl:'L',side:'united',player:'å­èª ',  hero:'ä¸‰å¥½'},
  {date:'2æœˆ1æ—¥',match:'ç¬¬2å ´',bet:150,wl:'L',side:'oda',   player:'Woman', hero:'æ£®ä»”'},
  {date:'2æœˆ1æ—¥',match:'ç¬¬2å ´',bet:150,wl:'L',side:'oda',   player:'å‚‘',    hero:'JJä½¬'},
  {date:'2æœˆ1æ—¥',match:'ç¬¬2å ´',bet:150,wl:'L',side:'oda',   player:'å­èª ',  hero:'ç¨»å§¬'},
  {date:'2æœˆ1æ—¥',match:'ç¬¬2å ´',bet:150,wl:'W',side:'united',player:'å“²',    hero:'æœå¿ƒ'},
  {date:'2æœˆ1æ—¥',match:'ç¬¬2å ´',bet:150,wl:'W',side:'united',player:'ä¿Š',    hero:'æ…¶æ¬¡'},
  {date:'2æœˆ1æ—¥',match:'ç¬¬2å ´',bet:150,wl:'W',side:'united',player:'æœæ¼”',  hero:'æ‘ä¸Š'},
  {date:'2æœˆ1æ—¥',match:'ç¬¬3å ´',bet:150,wl:'W',side:'oda',   player:'å“²',    hero:'æœå¿ƒ'},
  {date:'2æœˆ1æ—¥',match:'ç¬¬3å ´',bet:150,wl:'W',side:'oda',   player:'æœæ¼”',  hero:'æ£®ä»”'},
  {date:'2æœˆ1æ—¥',match:'ç¬¬3å ´',bet:150,wl:'W',side:'oda',   player:'ä¿Š',    hero:'ä¿¡é•·'},
  {date:'2æœˆ1æ—¥',match:'ç¬¬3å ´',bet:150,wl:'L',side:'united',player:'å‚‘',    hero:'ç™¾åœ°'},
  {date:'2æœˆ1æ—¥',match:'ç¬¬3å ´',bet:150,wl:'L',side:'united',player:'Woman', hero:'è‚¥å·'},
  {date:'2æœˆ1æ—¥',match:'ç¬¬3å ´',bet:150,wl:'L',side:'united',player:'å­èª ',  hero:'ç‰›ç‰›'},
  {date:'2æœˆ7æ—¥',match:'ç¬¬1å ´',bet:150,wl:'L',side:'oda',   player:'å­èª ',  hero:'ç¾©é¾'},
  {date:'2æœˆ7æ—¥',match:'ç¬¬1å ´',bet:150,wl:'L',side:'oda',   player:'æœæ¼”',  hero:'å·éŒ¢ä½¬'},
  {date:'2æœˆ7æ—¥',match:'ç¬¬1å ´',bet:150,wl:'L',side:'oda',   player:'å‚‘',    hero:'JJä½¬'},
  {date:'2æœˆ7æ—¥',match:'ç¬¬1å ´',bet:150,wl:'W',side:'united',player:'Water', hero:'ç›´æ±Ÿ'},
  {date:'2æœˆ7æ—¥',match:'ç¬¬1å ´',bet:150,wl:'W',side:'united',player:'å“²',    hero:'ä¸‰å¥½'},
  {date:'2æœˆ7æ—¥',match:'ç¬¬1å ´',bet:150,wl:'W',side:'united',player:'Woman', hero:'é¦¬å ´'},
  {date:'2æœˆ7æ—¥',match:'ç¬¬2å ´',bet:150,wl:'W',side:'oda',   player:'Water', hero:'ä¿¡é•·'},
  {date:'2æœˆ7æ—¥',match:'ç¬¬2å ´',bet:150,wl:'W',side:'oda',   player:'å“²',    hero:'ç¾©é¾'},
  {date:'2æœˆ7æ—¥',match:'ç¬¬2å ´',bet:150,wl:'W',side:'oda',   player:'Woman', hero:'æ£®ä»”'},
  {date:'2æœˆ7æ—¥',match:'ç¬¬2å ´',bet:150,wl:'L',side:'united',player:'å­èª ',  hero:'æœå¿ƒ'},
  {date:'2æœˆ7æ—¥',match:'ç¬¬2å ´',bet:150,wl:'L',side:'united',player:'æœæ¼”',  hero:'è‚¥å·'},
  {date:'2æœˆ7æ—¥',match:'ç¬¬2å ´',bet:150,wl:'L',side:'united',player:'å‚‘',    hero:'ç™¾åœ°'},
  {date:'2æœˆ8æ—¥',match:'ç¬¬1å ´',bet:200,wl:'W',side:'oda',   player:'å­èª ',  hero:'ç€§å·'},
  {date:'2æœˆ8æ—¥',match:'ç¬¬1å ´',bet:200,wl:'W',side:'oda',   player:'æœæ¼”',  hero:'æ£®ä»”'},
  {date:'2æœˆ8æ—¥',match:'ç¬¬1å ´',bet:200,wl:'W',side:'oda',   player:'å‚‘',    hero:'é…’äº•'},
  {date:'2æœˆ8æ—¥',match:'ç¬¬1å ´',bet:200,wl:'L',side:'united',player:'å“²',    hero:'ç›´æ±Ÿ'},
  {date:'2æœˆ8æ—¥',match:'ç¬¬1å ´',bet:200,wl:'L',side:'united',player:'Woman', hero:'è‚¥å·'},
  {date:'2æœˆ8æ—¥',match:'ç¬¬1å ´',bet:200,wl:'L',side:'united',player:'ä¿Š',    hero:'ç¾©é¾'},
  {date:'2æœˆ8æ—¥',match:'ç¬¬2å ´',bet:200,wl:'W',side:'oda',   player:'å“²',    hero:'ä½ä½'},
  {date:'2æœˆ8æ—¥',match:'ç¬¬2å ´',bet:200,wl:'W',side:'oda',   player:'Woman', hero:'é…’äº•'},
  {date:'2æœˆ8æ—¥',match:'ç¬¬2å ´',bet:200,wl:'W',side:'oda',   player:'ä¿Š',    hero:'ç¾½æŸ´'},
  {date:'2æœˆ8æ—¥',match:'ç¬¬2å ´',bet:200,wl:'L',side:'united',player:'å­èª ',  hero:'é¢¨é­”'},
  {date:'2æœˆ8æ—¥',match:'ç¬¬2å ´',bet:200,wl:'L',side:'united',player:'æœæ¼”',  hero:'ç‰›ç‰›'},
  {date:'2æœˆ8æ—¥',match:'ç¬¬2å ´',bet:200,wl:'L',side:'united',player:'å‚‘',    hero:'é“é›ª'},
  {date:'2æœˆ8æ—¥',match:'ç¬¬3å ´',bet:200,wl:'W',side:'oda',   player:'å­èª ',  hero:'æ¿ƒå§¬'},
  {date:'2æœˆ8æ—¥',match:'ç¬¬3å ´',bet:200,wl:'W',side:'oda',   player:'æœæ¼”',  hero:'åˆ©å®¶'},
  {date:'2æœˆ8æ—¥',match:'ç¬¬3å ´',bet:200,wl:'W',side:'oda',   player:'å‚‘',    hero:'å–®ç¾½'},
  {date:'2æœˆ8æ—¥',match:'ç¬¬3å ´',bet:200,wl:'L',side:'united',player:'å“²',    hero:'å‹è³´'},
  {date:'2æœˆ8æ—¥',match:'ç¬¬3å ´',bet:200,wl:'L',side:'united',player:'Woman', hero:'é¦¬å ´'},
  {date:'2æœˆ8æ—¥',match:'ç¬¬3å ´',bet:200,wl:'L',side:'united',player:'ä¿Š',    hero:'å…‰ç§€'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬1å ´',bet:300,wl:'W',side:'oda',  player:'å‚‘',    hero:'å–®ç¾½'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬1å ´',bet:300,wl:'W',side:'oda',  player:'å­èª ',  hero:'ç¨»å§¬'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬1å ´',bet:300,wl:'W',side:'oda',  player:'æœæ¼”',  hero:'åˆ©å®¶'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬1å ´',bet:300,wl:'W',side:'oda',  player:'Woman', hero:'æ£®ä»”'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬1å ´',bet:300,wl:'L',side:'united',player:'å“²',   hero:'å‹è³´'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬1å ´',bet:300,wl:'L',side:'united',player:'ä¿Š',   hero:'ç›´æ±Ÿ'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬1å ´',bet:300,wl:'L',side:'united',player:'Water',hero:'æ¯›æ¯›'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬2å ´',bet:300,wl:'W',side:'oda',  player:'å“²',    hero:'æœå¿ƒ'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬2å ´',bet:300,wl:'W',side:'oda',  player:'æœæ¼”',  hero:'æ£®ä»”'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬2å ´',bet:300,wl:'W',side:'oda',  player:'ä¿Š',    hero:'ç¾©é¾'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬2å ´',bet:300,wl:'L',side:'united',player:'å‚‘',   hero:'ç‹—å¥³'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬2å ´',bet:300,wl:'L',side:'united',player:'Woman',hero:'è‚¥å·'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬2å ´',bet:300,wl:'L',side:'united',player:'Water',hero:'æœä¿¡'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬3å ´',bet:300,wl:'W',side:'oda',  player:'å‚‘',    hero:'é“é›ª'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬3å ´',bet:300,wl:'W',side:'oda',  player:'Woman', hero:'ç¥åŸ'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬3å ´',bet:300,wl:'W',side:'oda',  player:'Water', hero:'ä¿¡é•·'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬3å ´',bet:300,wl:'L',side:'united',player:'å“²',   hero:'å‹è³´'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬3å ´',bet:300,wl:'L',side:'united',player:'æœæ¼”', hero:'ç‰›ç‰›'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬3å ´',bet:300,wl:'L',side:'united',player:'ä¿Š',   hero:'ç›´æ±Ÿ'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬4å ´',bet:300,wl:'W',side:'oda',  player:'å“²',    hero:'ä¿¡é•·'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬4å ´',bet:300,wl:'W',side:'oda',  player:'æœæ¼”',  hero:'åˆ©å®¶'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬4å ´',bet:300,wl:'W',side:'oda',  player:'ä¿Š',    hero:'ç¾©é¾'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬4å ´',bet:300,wl:'L',side:'united',player:'å‚‘',   hero:'å®—èŒ‚'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬4å ´',bet:300,wl:'L',side:'united',player:'Woman',hero:'é¦¬å ´'},
  {date:'2æœˆ15æ—¥',match:'ç¬¬4å ´',bet:300,wl:'L',side:'united',player:'Water',hero:'åŠ ä»”'},
  {date:'2æœˆ16æ—¥',match:'ç¬¬1å ´',bet:500,wl:'W',side:'oda',  player:'å‚‘',    hero:'å–®ç¾½'},
  {date:'2æœˆ16æ—¥',match:'ç¬¬1å ´',bet:500,wl:'W',side:'oda',  player:'æœæ¼”',  hero:'æ£®ä»”'},
  {date:'2æœˆ16æ—¥',match:'ç¬¬1å ´',bet:500,wl:'W',side:'oda',  player:'å­èª ',  hero:'ä¹é¬¼'},
  {date:'2æœˆ16æ—¥',match:'ç¬¬1å ´',bet:500,wl:'L',side:'united',player:'å“²',   hero:'åƒä»£å¥³'},
  {date:'2æœˆ16æ—¥',match:'ç¬¬1å ´',bet:500,wl:'L',side:'united',player:'Water',hero:'æ¯›æ¯›'},
  {date:'2æœˆ16æ—¥',match:'ç¬¬1å ´',bet:500,wl:'L',side:'united',player:'Woman',hero:'è‚¥å·'},
  {date:'2æœˆ16æ—¥',match:'ç¬¬2å ´',bet:500,wl:'W',side:'united',player:'å‚‘',   hero:'åŠ ä»”'},
  {date:'2æœˆ16æ—¥',match:'ç¬¬2å ´',bet:500,wl:'W',side:'united',player:'æœæ¼”', hero:'è‚¥å·'},
  {date:'2æœˆ16æ—¥',match:'ç¬¬2å ´',bet:500,wl:'W',side:'united',player:'å­èª ', hero:'å‹è³´'},
  {date:'2æœˆ16æ—¥',match:'ç¬¬2å ´',bet:500,wl:'L',side:'oda',  player:'å“²',    hero:'ç¾©é¾'},
  {date:'2æœˆ16æ—¥',match:'ç¬¬2å ´',bet:500,wl:'L',side:'oda',  player:'Water', hero:'ä¿¡é•·'},
  {date:'2æœˆ16æ—¥',match:'ç¬¬2å ´',bet:500,wl:'L',side:'oda',  player:'Woman', hero:'æ£®ä»”'},
];

const dateNum  = d=>{const m=d.match(/(\d+)æœˆ(\d+)æ—¥/);return m?+m[1]*100+ +m[2]:0;};
const matchNum = s=>{const m=s.match(/ç¬¬(\d+)å ´/);return m?+m[1]:0;};
const rateCol  = r=>r>=60?'#4ade80':r>=40?'#fbbf24':'#f87171';

function parseCSV(text){
  const lines=text.trim().split('\n');
  let headIdx=0;
  for(let i=0;i<Math.min(lines.length,10);i++){
    if(lines[i].includes('ç©å®¶')||lines[i].toLowerCase().includes('player')){headIdx=i;break;}
  }
  return lines.slice(headIdx+1).map(line=>{
    const cols=[];let cur='',inQ=false;
    for(const ch of line){
      if(ch==='"')inQ=!inQ;
      else if(ch===','&&!inQ){cols.push(cur.trim());cur='';}
      else cur+=ch;
    }
    cols.push(cur.trim());
    const clean=cols.map(c=>c.replace(/"/g,'').trim());
    const[date,match,betStr,wl,sideRaw,player,hero]=clean;
    if(!date||!wl||!player)return null;
    const side=sideRaw==='ç¹”ç”°è»'||sideRaw.toLowerCase()==='oda'?'oda':'united';
    return{date,match,bet:parseInt(betStr)||0,wl:wl.toUpperCase(),side,player,hero:hero||''};
  }).filter(Boolean);
}

function buildMatches(rows){
  const map={};
  rows.forEach(r=>{
    const key=`${r.date}_${r.match}`;
    if(!map[key])map[key]={date:r.date,match:r.match,bet:r.bet,oda:[],united:[],winner:null};
    (r.side==='oda'?map[key].oda:map[key].united).push({player:r.player,hero:r.hero});
    if(r.wl==='W')map[key].winner=r.side;
  });
  return Object.values(map).sort((a,b)=>{
    const dd=dateNum(b.date)-dateNum(a.date);
    return dd!==0?dd:matchNum(a.match)-matchNum(b.match);
  });
}

function buildPlayerStats(matches){
  const pd={};
  const ensure=n=>{if(!pd[n])pd[n]={name:n,wins:0,losses:0,money:0,history:[],heroes:{}};};
  matches.forEach(m=>{
    const oc=m.oda.length,uc=m.united.length,bet=m.bet;
    let odD=0,unD=0;
    if(m.winner==='oda'){odD=oc>0?(uc*bet/oc):0;unD=-bet;}
    else{unD=uc>0?(oc*bet/uc):0;odD=-bet;}
    const proc=(list,isWin,delta)=>{
      list.forEach(p=>{
        ensure(p.player);
        const d=pd[p.player];
        isWin?d.wins++:d.losses++;
        d.money+=delta;
        d.history.push({won:isWin,dn:dateNum(m.date),mn:matchNum(m.match)});
        if(!d.heroes[p.hero])d.heroes[p.hero]={wins:0,losses:0};
        isWin?d.heroes[p.hero].wins++:d.heroes[p.hero].losses++;
      });
    };
    proc(m.oda,m.winner==='oda',odD);
    proc(m.united,m.winner==='united',unD);
  });
  return Object.values(pd).map(p=>{
    p.history.sort((a,b)=>a.dn!==b.dn?a.dn-b.dn:a.mn-b.mn);
    const total=p.wins+p.losses,rate=total?Math.round(p.wins/total*100):0;
    const heroStats=Object.entries(p.heroes)
      .map(([name,{wins,losses}])=>({name,wins,losses,total:wins+losses}))
      .sort((a,b)=>b.total-a.total||b.wins-a.wins);
    const spark=p.history.slice(-5).map(h=>h.won?1:0);
    while(spark.length<5)spark.unshift(null);
    const lastWon=p.history.length?p.history[p.history.length-1].won:false;
    let streak=0;
    for(let i=p.history.length-1;i>=0;i--){if(p.history[i].won===lastWon)streak++;else break;}
    return{...p,total,rate,heroStats,spark,streak,streakWin:lastWon};
  });
}

function buildTeamStats(matches){
  const tm={};
  matches.forEach(m=>{
    [['oda',m.oda],['united',m.united]].forEach(([side,pls])=>{
      const won=m.winner===side;
      const key=[...pls].map(p=>p.player).sort().join('Â·');
      if(!tm[key])tm[key]={key,members:[...pls].map(p=>p.player).sort(),wins:0,losses:0,heroes:{}};
      won?tm[key].wins++:tm[key].losses++;
      pls.forEach(p=>{tm[key].heroes[p.hero]=(tm[key].heroes[p.hero]||0)+1;});
    });
  });
  return Object.values(tm).map(t=>{
    const total=t.wins+t.losses,rate=total?Math.round(t.wins/total*100):0;
    const topHeroes=Object.entries(t.heroes).sort((a,b)=>b[1]-a[1]).slice(0,3).map(([h])=>h);
    return{...t,total,rate,topHeroes};
  }).filter(t=>t.total>=2).sort((a,b)=>b.rate-a.rate||b.total-a.total);
}

/* Sparkline â€” color matches win-rate ring */
function sparklineHTML(spark, col){
  const W=64,H=30,pad=3;
  const pts=spark.map((v,i)=>{
    const x=pad+(i/(spark.length-1))*(W-pad*2);
    const y=v===null?H/2:v===1?pad:H-pad;
    return{x,y,v};
  });
  const pointsStr=pts.map(p=>`${p.x},${p.y}`).join(' ');
  const dotsHTML=pts.map(p=>{
    if(p.v===null)return`<circle cx="${p.x}" cy="${p.y}" r="2" fill="rgba(255,255,255,0.1)"/>`;
    if(p.v===1)return`<circle cx="${p.x}" cy="${p.y}" r="2.8" fill="${col}"/>`;
    return`<circle cx="${p.x}" cy="${p.y}" r="2.8" fill="${col}" opacity="0.25"/>`;
  }).join('');
  return`<svg width="${W}" height="${H}" style="overflow:visible">
    <polyline points="${pointsStr}" fill="none" stroke="${col}" stroke-width="1.8"
      stroke-linejoin="round" stroke-linecap="round" opacity="0.75"/>
    ${dotsHTML}
  </svg>`;
}

function ringHTML(rate,size=48){
  const sw=4.5,r=(size-sw*2)/2,circ=2*Math.PI*r,col=rateCol(rate);
  const fs=Math.max(9,Math.round(size*.19));
  const off=circ*(1-rate/100);
  return`<div class="ring-wrap" style="width:${size}px;height:${size}px;flex-shrink:0">
    <svg width="${size}" height="${size}" style="transform:rotate(-90deg)">
      <circle cx="${size/2}" cy="${size/2}" r="${r}" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="${sw}"/>
      <circle cx="${size/2}" cy="${size/2}" r="${r}" fill="none" stroke="${col}" stroke-width="${sw}"
        stroke-dasharray="${circ}" stroke-dashoffset="${off}" stroke-linecap="round"/>
    </svg>
    <div class="ring-label" style="font-size:${fs}px;color:${col}">${rate}%</div>
  </div>`;
}

let openedPlayer=null,hSort='count';
let allPlayers=[],allMatches=[],allTeams=[],allPNames=[];

function renderPlayers(){
  const sorted=[...allPlayers].sort((a,b)=>b.rate-a.rate||b.money-a.money);
  const maxM=Math.max(...sorted.map(p=>p.money));
  const minM=Math.min(...sorted.map(p=>p.money));
  const odaW=allMatches.filter(m=>m.winner==='oda').length;
  const totM=allMatches.length;
  const odaPct=totM?Math.round(odaW/totM*100):50;
  const uniPct=100-odaPct;
  const odaCol=odaPct>=uniPct?'#4ade80':'#f87171';
  const uniCol=uniPct>odaPct?'#4ade80':'#f87171';

  let html=`
  <div class="sec-bar"><span>âš”ï¸ é™£ç‡Ÿå‹ç‡ Â· å…± ${totM} å ´</span></div>
  <div class="card">
    <div class="fac-nums">
      <div>
        <div class="fac-big" style="color:${odaCol}">${odaPct}%</div>
        <div class="fac-lbl">ğŸ”´ ç¹”ç”°è» Â· ${odaW} å‹</div>
      </div>
      <div style="text-align:right">
        <div class="fac-big" style="color:${uniCol}">${uniPct}%</div>
        <div class="fac-lbl">è¯åˆè» Â· ${totM-odaW} å‹ ğŸ”µ</div>
      </div>
    </div>
    <div class="fac-track">
      <div class="fac-seg" id="fac-oda" style="width:0;background:${odaPct>=uniPct?'linear-gradient(90deg,#14532d,#4ade80)':'linear-gradient(90deg,#7f1d1d,#f87171)'}"></div>
      <div class="fac-seg" id="fac-uni" style="width:0;background:${uniPct>odaPct?'linear-gradient(90deg,#14532d,#4ade80)':'linear-gradient(90deg,#7f1d1d,#f87171)'}"></div>
    </div>
  </div>

  <div class="sec-bar"><span>ğŸ† ç©å®¶ç¸½è¦½</span></div>
  <div class="ptable-wrap" style="overflow-x:auto">
    <div class="ptable-head">
      <span style="text-align:center">#</span>
      <span>ç©å®¶</span>
      <span>å‹ç‡</span>
      <span>èµ°å‹¢</span>
      <span>W / L / å ´</span>
      <span>è‹±é›„æ± </span>
      <span style="text-align:right">é‡‘é¡</span>
    </div>`;

  sorted.forEach((p,i)=>{
    const col=rateCol(p.rate);
    const rankIcon=i===0?'ğŸ¥‡':i===1?'ğŸ¥ˆ':i===2?'ğŸ¥‰':i+1;
    const rankCol=i===0?'#fbbf24':i===1?'#94a3b8':i===2?'#92400e':'#64748b';
    let badges='';
    if(p.streakWin&&p.streak>=3)badges+=`<span class="badge badge-win">ğŸ”¥${p.streak}é€£å‹</span>`;
    if(!p.streakWin&&p.streak>=3)badges+=`<span class="badge badge-lose">â„ï¸${p.streak}é€£æ•—</span>`;
    if(p.money===maxM&&p.money>0)badges+=`<span class="badge badge-gold">ğŸ’°å¤§æˆ¶</span>`;
    if(p.money===minM&&p.money<0)badges+=`<span class="badge badge-grey">ğŸ’¸</span>`;
    const dots=p.history.slice(-5).map(h=>`<div class="dot ${h.won?'dot-w':'dot-l'}"></div>`).join('');
    const isOpen=openedPlayer===p.name;
    const moneyRaw=Math.round(p.money*10)/10;
    const moneyStr=`${moneyRaw>=0?'+':''}$${moneyRaw}`;

    html+=`<div>
      <div class="prow${isOpen?' open':''}" onclick="togglePlayer('${p.name}')">
        <div style="text-align:center;font-size:${i<3?16:13}px;color:${rankCol};font-weight:700">${rankIcon}</div>
        <div>
          <div style="display:flex;align-items:center;gap:4px;flex-wrap:wrap;margin-bottom:5px">
            <span style="font-size:15px;font-weight:700;color:#f1f5f9">${p.name}</span>${badges}
          </div>
          <div class="dots">${dots}</div>
        </div>
        <div style="display:flex;justify-content:center">${ringHTML(p.rate,46)}</div>
        <div style="display:flex;justify-content:center;align-items:center">${sparklineHTML(p.spark,col)}</div>
        <div style="text-align:center">
          <div style="display:flex;align-items:baseline;justify-content:center;gap:3px">
            <span style="color:#4ade80;font-weight:700;font-size:16px">${p.wins}</span>
            <span style="color:#334155;font-size:12px">/</span>
            <span style="color:#f87171;font-size:16px;font-weight:600">${p.losses}</span>
          </div>
          <div style="font-size:12px;color:#475569;margin-top:2px">${p.total}å ´</div>
        </div>
        <div style="text-align:center">
          <div style="font-size:17px;font-weight:700;color:#38bdf8">${p.heroStats.length}</div>
        </div>
        <div style="text-align:right;font-weight:700;font-size:15px;color:${moneyRaw>=0?'#4ade80':'#f87171'}">${moneyStr}</div>
      </div>
      <div class="hero-expand" id="expand-${p.name}" style="max-height:${isOpen?'2000px':'0'};transition:max-height .25s ease">
        ${isOpen?heroExpandHTML(p):''}
      </div>
    </div>`;
  });

  html+=`</div>
  <div style="text-align:center;font-size:11px;color:#111d2e;margin-bottom:26px">â†‘ é»æ“Šè¡Œå¯å±•é–‹è©³æƒ… â†‘</div>
  <div class="sec-bar"><span>ğŸ¤ çµ„éšŠå‹ç‡</span></div>`;

  allTeams.forEach((t,ti)=>{
    const heroChips=t.topHeroes.map((h,i)=>`<span class="hero-chip hero-chip-${i}">${['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'][i]} ${h}</span>`).join('');
    html+=`<div class="team-card fade-up" style="animation-delay:${ti*.04}s">
      ${ringHTML(t.rate,52)}
      <div style="flex:1;min-width:130px">
        <div style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:7px">
          ${t.members.map(m=>`<span class="tag">${m}</span>`).join('')}
        </div>
        <div style="display:flex;align-items:center;flex-wrap:wrap;gap:4px">
          <span style="font-size:11px;color:#233455;margin-right:2px">é»˜å¥‘è‹±é›„</span>${heroChips}
        </div>
      </div>
      <div style="text-align:right;flex-shrink:0;min-width:65px">
        <div style="display:flex;align-items:baseline;justify-content:flex-end;gap:2px">
          <span style="color:#4ade80;font-weight:700;font-size:16px">${t.wins}</span>
          <span style="color:#1a3355;font-size:11px">W</span>
          <span style="color:#0d1a2e;font-size:11px;margin:0 2px">Â·</span>
          <span style="color:#f87171;font-size:16px;font-weight:600">${t.losses}</span>
          <span style="color:#1a3355;font-size:11px">L</span>
        </div>
        <div style="font-size:11px;color:#475569;margin-top:2px">${t.total} å ´</div>
      </div>
    </div>`;
  });

  document.getElementById('pane-players').innerHTML=html;
  setTimeout(()=>{
    const od=document.getElementById('fac-oda'),un=document.getElementById('fac-uni');
    const p2=totM?Math.round(odaW/totM*100):50;
    if(od)od.style.width=`${p2}%`;
    if(un)un.style.width=`${100-p2}%`;
  },100);
}

function heroExpandHTML(p){
  const s=[...p.heroStats].sort((a,b)=>{
    if(hSort==='rate'){const ra=a.total?a.wins/a.total:0,rb=b.total?b.wins/b.total:0;return rb-ra||b.total-a.total;}
    return b.total-a.total;
  });
  const sortBtns=['count','rate'].map(k=>`<button onclick="setHSort('${k}',event)" style="padding:2px 9px;background:${hSort===k?'#38bdf8':'rgba(15,25,48,.8)'};color:${hSort===k?'#000':'#475569'};border:1px solid ${hSort===k?'#38bdf8':'rgba(148,163,184,.08)'};border-radius:4px;cursor:pointer;font-size:11px;font-weight:700;font-family:inherit">${k==='count'?'æ¬¡æ•¸':'å‹ç‡'}</button>`).join('');
  return`<div style="padding:12px 16px 14px">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:9px;flex-wrap:wrap;gap:6px">
      <span style="font-size:11px;color:#1a3355;text-transform:uppercase;letter-spacing:.8px;font-weight:700">ä½¿ç”¨ç´€éŒ„ (${p.heroStats.length})</span>
      <div style="display:flex;gap:4px">${sortBtns}</div>
    </div>
    <div style="display:flex;flex-direction:column;gap:4px">
      ${s.map(h=>{const hr=h.total?Math.round(h.wins/h.total*100):0;return`
        <div class="hrow">
          <span style="font-size:13px;font-weight:600;color:#e2e8f0">${h.name}</span>
          <span style="font-size:11px;color:#233455">${h.total}å ´ Â· ${h.wins}W${h.losses?` / ${h.losses}L`:''}</span>
          <span style="font-size:14px;font-weight:700;color:${rateCol(hr)};text-align:right">${hr}%</span>
        </div>`}).join('')}
    </div>
  </div>`;
}

function renderMatches(){
  const dg={};
  allMatches.forEach(m=>(dg[m.date]=dg[m.date]||[]).push(m));
  Object.values(dg).forEach(ms=>ms.sort((a,b)=>matchNum(a.match)-matchNum(b.match)));
  const entries=Object.entries(dg).sort(([a],[b])=>dateNum(b)-dateNum(a));
  let html=`<div class="sec-bar"><span>ğŸ“… å°æˆ°æ­·å²</span></div>`;
  entries.forEach(([date,ms])=>{
    const dOdaW=ms.filter(m=>m.winner==='oda').length;
    const betAmt=ms[0]?.bet;
    html+=`<div style="margin-bottom:24px">
      <div class="date-hdr">
        <span style="font-size:15px;font-weight:700;color:#38bdf8">ğŸ“… ${date}</span>
        <div style="display:flex;gap:12px;font-size:12px;align-items:center;flex-wrap:wrap">
          <span style="color:#475569">${ms.length} å ´</span>
          <span style="color:#fbbf24;font-weight:600">ğŸ’° $${betAmt} / å ´</span>
          <span>
            <span style="color:#4ade80;font-weight:600">ç¹”ç”° ${dOdaW}W</span>
            <span style="color:#111d2e;margin:0 4px">Â·</span>
            <span style="color:#f87171;font-weight:600">è¯åˆ ${ms.length-dOdaW}W</span>
          </span>
        </div>
      </div>`;
    ms.forEach(m=>{
      html+=`<div class="match-card">
        <div class="match-meta">
          <span style="font-size:14px;font-weight:700;color:#64748b">${m.match}</span>
          <span style="font-size:12px;color:#1a3355">$${m.bet}</span>
        </div>
        <div class="teams-grid">
          ${[{team:m.oda,side:'oda',label:'ç¹”ç”°è»'},{team:m.united,side:'united',label:'è¯åˆè»'}].map(({team,side,label},si)=>{
            const won=m.winner===side;
            /* â˜… é™£å®¹å: å‹â†’ç¶ , æ•—â†’ç´… */
            const nameCol=won?'#4ade80':'#f87171';
            return`<div class="team-col" style="opacity:${won?1:.65};${si===0?'border-right:1px solid rgba(148,163,184,.06)':''}">
              <div class="team-col-hdr">
                <span style="font-size:13px;font-weight:800;color:${nameCol}">${label}</span>
                <span style="font-size:11px;font-weight:700;color:${won?'#4ade80':'#f87171'};padding:2px 8px;border-radius:6px;background:${won?'rgba(74,222,128,.07)':'rgba(248,113,113,.07)'}">${won?'å‹':'æ•—'}</span>
              </div>
              ${team.map((pl,pi)=>`
                <div class="p-line">
                  <span style="font-size:13px;font-weight:600;color:${won?'#e2e8f0':'#4b5563'}">${pl.player}</span>
                  <span style="font-size:12px;color:${won?'#3d5a7a':'#374151'};max-width:90px;text-align:right;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${pl.hero}</span>
                </div>`).join('')}
            </div>`;
          }).join('')}
        </div>
      </div>`;
    });
    html+=`</div>`;
  });
  document.getElementById('pane-matches').innerHTML=html;
}

let pickedSet=new Set(),teamRes=null;
function renderTools(){
  const pickItems=allPNames.map(n=>`<div class="pick-item${pickedSet.has(n)?' sel':''}" onclick="togglePick('${n}')">${pickedSet.has(n)?'âœ“ ':''}${n}</div>`).join('');
  const canRand=pickedSet.size>=6&&pickedSet.size<=7;
  let teamHTML='';
  if(teamRes){
    teamHTML=`<div class="team-result-card fade-up" style="margin-top:20px">
      <div style="text-align:center;font-size:18px;font-weight:700;color:#f1f5f9;margin-bottom:16px;letter-spacing:1.5px">âš”ï¸ åˆ†éšŠçµæœ</div>
      <div class="team-result-teams">
        ${[{team:teamRes.oda,label:'ğŸ”´ ç¹”ç”°è»',col:'#ef4444'},{team:teamRes.united,label:'ğŸ”µ è¯åˆè»',col:'#3b82f6'}].map(({team,label,col})=>`
          <div class="result-team" style="border-top:2px solid ${col}">
            <div style="font-size:13px;font-weight:800;color:${col};margin-bottom:10px">${label} (${team.length}äºº)</div>
            ${team.map((n,i)=>`<div style="font-size:15px;font-weight:600;padding:7px 0;border-bottom:${i<team.length-1?'1px solid rgba(255,255,255,.04)':'none'};color:#e2e8f0">${n}</div>`).join('')}
          </div>`).join('')}
      </div>
      <div style="text-align:center;margin-top:14px">
        <button onclick="doRandom()" style="padding:8px 24px;border-radius:6px;border:1px solid rgba(148,163,184,.08);background:rgba(8,16,32,.7);color:#475569;font-size:13px;font-weight:600;cursor:pointer;font-family:inherit">ğŸ² é‡æ–°åˆ†éšŠ</button>
      </div>
    </div>`;
  }
  document.getElementById('pane-tools').innerHTML=`
    <div class="sec-bar"><span>ğŸ² éš¨æ©Ÿåˆ†éšŠå·¥å…·</span></div>
    <div class="card">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:14px">
        <span style="font-size:15px;font-weight:600;color:#f1f5f9">é¸æ“‡ 6 æˆ– 7 ä½ç©å®¶</span>
        <span style="font-size:13px;color:${canRand?'#4ade80':'#475569'}">å·²é¸ ${pickedSet.size} äºº${canRand?' âœ“':''}</span>
      </div>
      <div class="pick-grid">${pickItems}</div>
      <div style="text-align:center"><button onclick="doRandom()" class="rand-btn ${canRand?'on':'off'}">ğŸ² éš¨æ©Ÿåˆ†éšŠ</button></div>
    </div>${teamHTML}`;
}

function setTab(id){
  document.querySelectorAll('.tab-btn').forEach((b,i)=>b.classList.toggle('active',['players','matches','tools'][i]===id));
  document.querySelectorAll('.tab-pane').forEach(p=>p.classList.remove('active'));
  document.getElementById(`pane-${id}`).classList.add('active');
}
function togglePlayer(name){
  openedPlayer=openedPlayer===name?null:name;
  renderPlayers();
  setTimeout(()=>{
    const od=document.getElementById('fac-oda'),un=document.getElementById('fac-uni');
    const w=allMatches.filter(m=>m.winner==='oda').length,t=allMatches.length,pct=t?Math.round(w/t*100):50;
    if(od)od.style.width=`${pct}%`;if(un)un.style.width=`${100-pct}%`;
  },100);
}
function setHSort(k,e){
  e&&e.stopPropagation();hSort=k;
  if(openedPlayer){
    const el=document.getElementById(`expand-${openedPlayer}`);
    const p=allPlayers.find(x=>x.name===openedPlayer);
    if(el&&p)el.innerHTML=heroExpandHTML(p);
  }
}
function togglePick(n){pickedSet.has(n)?pickedSet.delete(n):pickedSet.add(n);renderTools();}
function doRandom(){
  if(pickedSet.size<6||pickedSet.size>7)return alert('è«‹é¸æ“‡ 6 æˆ– 7 ä½ç©å®¶ï¼');
  const sel=[...pickedSet];
  for(let i=sel.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[sel[i],sel[j]]=[sel[j],sel[i]];}
  const h=Math.ceil(sel.length/2);
  teamRes={oda:sel.slice(0,h),united:sel.slice(h)};
  renderTools();
}

(async function init(){
  const badge=document.getElementById('live-badge');
  let liveRows=null;
  try{
    const ctrl=new AbortController();
    const tmr=setTimeout(()=>ctrl.abort(),9000);
    const res=await fetch(CSV_URL,{signal:ctrl.signal});
    clearTimeout(tmr);
    if(!res.ok)throw new Error(`HTTP ${res.status}`);
    const text=await res.text();
    const parsed=parseCSV(text);
    if(parsed.length>5)liveRows=parsed;
    else throw new Error('æ•¸æ“šä¸è¶³');
  }catch(e){}
  const finalRows=liveRows||SEED_ROWS;
  allMatches=buildMatches(finalRows);
  allPlayers=buildPlayerStats(allMatches);
  allTeams=buildTeamStats(allMatches);
  allPNames=[...new Set(finalRows.map(r=>r.player))];
  if(liveRows){
    badge.style.cssText='padding:3px 11px;border-radius:20px;font-size:11px;font-weight:700;flex-shrink:0;letter-spacing:.5px;background:rgba(74,222,128,.11);border:1px solid rgba(74,222,128,.35);color:#4ade80';
    badge.textContent='â— LIVE';
  }else{
    badge.style.cssText='padding:3px 11px;border-radius:20px;font-size:11px;font-weight:700;flex-shrink:0;letter-spacing:.5px;background:rgba(71,85,105,.11);border:1px solid rgba(71,85,105,.35);color:#475569';
    badge.textContent='â— DEMO';
  }
  renderPlayers();renderMatches();renderTools();
})();
</script>
<footer>âœ¦ ä¿¡é•·ä¹‹é‡æœ› æˆ°ç¸¾ç¶² Â· æ•¸æ“šç”± Google Sheets é©…å‹• âœ¦</footer>
</body>
</html>
